[build]
  publish = "public"
  command = """
    # Warna untuk output
    GREEN='\\033[0;32m'
    YELLOW='\\033[1;33m'
    RED='\\033[0;31m'
    CYAN='\\033[0;36m'
    NC='\\033[0m' # no color

    echo -e "${CYAN}üöÄ Starting Hugo build...${NC}"
    if hugo; then
      echo -e "${GREEN}‚úÖ Hugo build completed.${NC}"

      SITEMAP_PATH="public/sitemap.xml"
      TODAY=$(date -u +"%Y-%m-%d")

      if [ ! -f "$SITEMAP_PATH" ]; then
        echo -e "${RED}‚ùå sitemap.xml tidak ditemukan, skip IndexNow.${NC}"
        exit 0
      fi

      echo -e "${CYAN}üìÑ Parsing sitemap.xml...${NC}"
      URLS_SORTED=$(grep -E '<loc>|<lastmod>' "$SITEMAP_PATH" \
        | sed -e 's/<loc>//;s|</loc>||;s/<lastmod>//;s|</lastmod>||' \
        | paste - - \
        | sort -rk2
      )

      URLS_TODAY=$(echo "$URLS_SORTED" | grep "$TODAY" | awk '{print $1}')

      if [ -n "$URLS_TODAY" ]; then
        echo -e "${GREEN}üìÖ Ditemukan $(echo "$URLS_TODAY" | wc -l) URL baru hari ini.${NC}"
        URLS_TO_SEND="$URLS_TODAY"
      else
        echo -e "${YELLOW}‚ÑπÔ∏è Tidak ada URL baru hari ini, pakai 5 URL terbaru.${NC}"
        URLS_TO_SEND=$(echo "$URLS_SORTED" | head -n 5 | awk '{print $1}')
      fi

      echo "$URLS_TO_SEND" > /tmp/latest_urls.txt
      echo -e "${CYAN}üîç URLs to send:${NC}"
      cat /tmp/latest_urls.txt

      URL_JSON_ARRAY=$(printf '"%s",' $URLS_TO_SEND)
      URL_JSON_ARRAY=${URL_JSON_ARRAY%,}

      JSON_PAYLOAD=$(cat <<EOF
{
  "host": "akazed.com",
  "key": "${INDEXNOW_KEY}",
  "keyLocation": "https://akazed.com/${INDEXNOW_KEY_FILENAME}",
  "urlList": ["https://akazed.com/sitemap.xml", $URL_JSON_ARRAY]
}
EOF
)

      echo -e "${CYAN}üì§ Sending URL list to IndexNow...${NC}"
      RESPONSE=$(curl -s -o /tmp/indexnow_response.txt -w "%{http_code}" \
        -X POST https://api.indexnow.org/indexnow \
        -H 'Content-Type: application/json' \
        -d "$JSON_PAYLOAD"
      )

      if [ "$RESPONSE" -eq 202 ]; then
        echo -e "${GREEN}üì° IndexNow HTTP Status: $RESPONSE (Success)${NC}"
      else
        echo -e "${RED}üì° IndexNow HTTP Status: $RESPONSE (Failed)${NC}"
      fi

      echo -e "${CYAN}üìù Response body:${NC}"
      cat /tmp/indexnow_response.txt
    else
      echo -e "${RED}‚ùå Hugo build failed, skipping IndexNow ping.${NC}"
    fi
  """

[context.production.environment]
  HUGO_VERSION = "0.123.1"