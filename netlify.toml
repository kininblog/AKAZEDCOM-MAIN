[build]
  publish = "public"
  command = """
    echo 'üöÄ Starting Hugo build...'
    if hugo; then
      echo '‚úÖ Hugo build completed.'

      # Ambil 5 URL terbaru dari post
      echo 'üìÑ Collecting latest URLs...'
      LATEST_URLS=$(find public -name "index.html" | grep -vE "/page/|/tags/|/categories/" \
        | sed 's|public||;s|index.html$||;s|^/||' \
        | head -n 5 \
        | sed 's|^|https://akazed.com/|')

      echo "$LATEST_URLS" > /tmp/latest_urls.txt
      echo 'üîç Latest URLs to send:'
      cat /tmp/latest_urls.txt

      # Ubah daftar URL menjadi format JSON array
      URL_JSON_ARRAY=$(printf '"%s",' $LATEST_URLS)
      URL_JSON_ARRAY=${URL_JSON_ARRAY%,} # hapus koma terakhir

      # Buat payload JSON untuk IndexNow
      JSON_PAYLOAD=$(cat <<EOF
{
  "host": "akazed.com",
  "key": "${INDEXNOW_KEY}",
  "keyLocation": "https://akazed.com/${INDEXNOW_KEY_FILENAME}",
  "urlList": ["https://akazed.com/sitemap.xml", $URL_JSON_ARRAY]
}
EOF
)

      # Kirim ke IndexNow
      echo 'üì§ Sending URL list to IndexNow...'
      RESPONSE=$(curl -s -o /tmp/indexnow_response.txt -w "%{http_code}" \
        -X POST https://api.indexnow.org/indexnow \
        -H 'Content-Type: application/json' \
        -d "$JSON_PAYLOAD"
      )

      echo "üì° IndexNow HTTP Status: $RESPONSE"
      echo "üìù Response body:"
      cat /tmp/indexnow_response.txt
    else
      echo '‚ùå Hugo build failed, skipping IndexNow ping.'
    fi
  """

[context.production.environment]
  HUGO_VERSION = "0.123.1"
