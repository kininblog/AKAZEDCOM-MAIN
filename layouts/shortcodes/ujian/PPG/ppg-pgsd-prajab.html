    <style>
        :root {
            --primary-bg: #f0f2f5;
            --panel-bg: #ffffff;
            --header-bg: #2c3e50; /* Biru Gelap Netral */
            --header-text: #ffffff;
            --text-color: #333333;
            --border-color: #dee2e6;
            --primary-action-bg: #3498db; /* Biru Cerah */
            --primary-action-hover: #2980b9;
            --answered-bg: #2ecc71; /* Hijau Zamrud */
            --correct-bg: #e8f5e9;
            --correct-text: #27ae60;
            --incorrect-bg: #ffebee;
            --incorrect-text: #c0392b;
            --doubtful-bg: #f1c40f; /* Kuning Bunga Matahari */
            --current-bg: #e67e22; /* Oranye Wortel */
            --unanswered-bg: #ffffff;
            --timer-alert: #e74c3c; /* Merah Alizarin */
        }

        /* --- Halaman Login --- */
        #login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-grow: 1;
            padding: 20px;
        }
        .login-box {
            background-color: var(--panel-bg);
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        .login-box h2 {
            margin-top: 0;
            margin-bottom: 25px;
            color: var(--header-bg);
        }
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box;
        }
        #login-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-action-bg);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #login-btn:hover {
            background-color: var(--primary-action-hover);
        }
        #login-error {
            color: var(--timer-alert);
            margin-top: 15px;
            font-weight: 500;
            display: none;
        }

        /* Header */
        .header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header h2 {
            font-size: 1.2em;
            margin: 0;
        }
        .user-info {
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        #logout-btn {
            background: none;
            border: 1px solid var(--header-text);
            color: var(--header-text);
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #logout-btn:hover {
            background-color: rgba(255,255,255,0.1);
        }


        /* Main Container */
        .quiz-container {
            display: flex;
            flex: 1;
            padding: 15px;
            gap: 15px;
            overflow: hidden;
            height: calc(100vh - 58px); /* Adjusted for header height */
        }

        /* Question Panel (Left) */
        .question-panel {
            flex: 3;
            background-color: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .question-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            background-color: #f8f9fa;
        }
        .question-header #subtest-title {
            font-weight: 700;
            color: var(--header-bg);
        }
        .question-body {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
            line-height: 1.6;
        }
        .question-text {
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        .options-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .options-list li {
            margin-bottom: 10px;
        }
        .options-list label {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .options-list label:hover {
            background-color: #e3f2fd;
        }
        .options-list input[type="radio"] {
            margin-right: 15px;
            margin-top: 5px;
        }
        .options-list input[type="radio"]:checked + span {
            font-weight: 700;
        }
        .options-list label.selected {
            background-color: #bbdefb;
            border-color: var(--primary-action-bg);
        }

        /* Navigation Panel (Right) */
        .navigation-panel {
            flex: 1.2;
            background-color: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            min-width: 300px;
        }
        .timer-box {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }
        #timer {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--header-bg);
            letter-spacing: 2px;
        }
        #timer.low-time {
            color: var(--timer-alert);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .question-grid-container {
            padding: 15px;
            flex: 1;
            overflow-y: auto;
        }
        .subtest-group {
            margin-bottom: 15px;
        }
        .subtest-group h3 {
            font-size: 0.9em;
            margin: 0 0 10px 0;
            color: var(--text-color);
            border-bottom: 2px solid var(--primary-action-bg);
            padding-bottom: 5px;
        }
        .question-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 8px;
        }
        .grid-button {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border-color);
            background-color: var(--unanswered-bg);
            cursor: pointer;
            border-radius: 5px;
            font-weight: 500;
            transition: all 0.2s;
        }
        .grid-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .grid-button.answered { background-color: var(--answered-bg); color: white; border-color: var(--answered-bg); }
        .grid-button.doubtful { background-color: var(--doubtful-bg); border-color: var(--doubtful-bg); }
        .grid-button.current { border: 2px solid var(--current-bg); }

        /* Footer / Actions */
        .quiz-actions {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8f9fa;
        }
        .action-button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 700;
            transition: background-color 0.2s;
        }
        #prev-btn, #next-btn {
            background-color: var(--primary-action-bg);
            color: white;
        }
        #prev-btn:disabled, #next-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #doubtful-btn {
            background-color: var(--doubtful-bg);
            color: #333;
        }
        #finish-btn {
            background-color: var(--timer-alert);
            color: white;
        }

        /* Confirmation Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            animation: slide-down 0.3s ease-out;
        }
        @keyframes slide-down {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-content h2 {
            margin-top: 0;
            color: var(--header-bg);
        }
        .modal-actions {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        #confirm-yes {
            background-color: var(--primary-action-bg);
            color: white;
        }
        #confirm-no {
            background-color: #6c757d;
            color: white;
        }
        
        /* --- Result Page Styles --- */
        .result-container {
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        .result-container h2, .result-container h3 {
            color: var(--header-bg);
        }
        .result-card {
            background-color: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .overall-summary {
            text-align: center;
        }
        .overall-summary .score {
            font-size: 3em;
            font-weight: 700;
            color: var(--answered-bg);
        }
        .overall-summary .score-details {
            font-size: 1.1em;
            color: var(--text-color);
        }
        .subtest-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .subtest-card {
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            text-align: center;
        }
        .subtest-card h4 {
            margin: 0 0 10px 0;
        }
        .subtest-card .subtest-score {
            font-size: 1.5em;
            font-weight: 500;
        }

        .answer-list {
            padding: 0;
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .answer-list li {
            width: 35px;
            height: 35px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            font-weight: 500;
        }
        .answer-list li.correct {
            background-color: var(--correct-text);
            color: white;
        }
        .answer-list li.incorrect {
            background-color: var(--incorrect-text);
            color: white;
        }
        
        .review-item {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        .review-item .review-q-text {
            font-weight: 500;
        }
        .review-item .review-answer {
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
        }
        .review-item .user-answer {
            background-color: var(--incorrect-bg);
            border-left: 4px solid var(--incorrect-text);
            color: var(--incorrect-text);
        }
        .review-item .correct-answer {
            background-color: var(--correct-bg);
            border-left: 4px solid var(--correct-text);
            color: var(--correct-text);
        }
        .review-item .explanation {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-style: italic;
        }
        #restart-btn {
            margin-top: 20px;
            padding: 12px 25px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: var(--primary-action-bg);
            color: white;
        }
        
        /* Hidden by default */
        .header, .quiz-container, #result-page {
            display: none;
        }
        
        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            .quiz-container {
                flex-direction: column;
                height: auto;
                overflow: visible;
            }
            .navigation-panel {
                min-width: unset;
                flex: unset; /* Unset flex grow/shrink */
                height: auto;
            }
            .question-panel {
                min-height: 40vh;
            }
            .header h2 {
                font-size: 1em;
            }
        }
        
        @media (max-width: 480px) {
            .login-box {
                padding: 20px;
            }
            .question-body, .quiz-actions {
                padding: 15px;
            }
            .action-button {
                padding: 8px 12px;
                font-size: 0.9em;
            }
        }

    </style>
    
    <div id="login-container">
        <div class="login-box">
            <h2>Login Peserta Ujian</h2>
            <div class="input-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Masukkan username Anda">
            </div>
            <div class="input-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Masukkan password">
            </div>
            <button id="login-btn">Masuk</button>
            <p id="login-error">Password salah. Coba lagi.</p>
        </div>
    </div>

    <header class="header">
        <h2>Tryout Seleksi PPG Prajabatan PGSD</h2>
        <div class="user-info">
            <span id="header-info"></span>
            <button id="logout-btn">Logout</button>
        </div>
    </header>

    <div class="quiz-container">
        <!-- Panel Soal -->
        <main class="question-panel">
            <div class="question-header">
                <span id="subtest-title">Subtes</span> | Soal No. <span id="question-number">1</span>
            </div>
            <div class="question-body">
                <p id="question-text">Memuat soal...</p>
                <ul id="options" class="options-list"></ul>
            </div>
            <div class="quiz-actions">
                <button id="prev-btn" class="action-button">Sebelumnya</button>
                <button id="doubtful-btn" class="action-button">Ragu-ragu</button>
                <button id="next-btn" class="action-button">Selanjutnya</button>
            </div>
        </main>

        <!-- Panel Navigasi -->
        <aside class="navigation-panel">
            <div class="timer-box">
                Sisa Waktu
                <div id="timer">150:00</div>
            </div>
            <div class="question-grid-container">
                <div class="subtest-group">
                    <h3>Penguasaan Konten (1-50)</h3>
                    <div id="grid-konten" class="question-grid"></div>
                </div>
                <div class="subtest-group">
                    <h3>Kemampuan Dasar: Literasi (51-75)</h3>
                    <div id="grid-literasi" class="question-grid"></div>
                </div>
                <div class="subtest-group">
                    <h3>Kemampuan Dasar: Numerasi (76-100)</h3>
                    <div id="grid-numerasi" class="question-grid"></div>
                </div>
            </div>
            <div class="quiz-actions" style="justify-content: center;">
                <button id="finish-btn" class="action-button">Selesaikan Ujian</button>
            </div>
        </aside>
    </div>

    <!-- Halaman Hasil Ujian -->
    <div id="result-page" class="result-container">
        <div class="result-card overall-summary">
            <h2>Hasil Akhir Ujian</h2>
            <div id="final-score" class="score">0%</div>
            <div id="score-details" class="score-details"></div>
            <div id="subtest-analysis-container" class="subtest-analysis"></div>
        </div>
        
        <div class="result-card">
            <h3>Rekap Jawaban</h3>
            <h4>Jawaban Benar</h4>
            <ul id="correct-list" class="answer-list"></ul>
            <h4 style="margin-top: 20px;">Jawaban Salah / Kosong</h4>
            <ul id="incorrect-list" class="answer-list"></ul>
        </div>
        
        <div id="review-section-container" class="result-card">
            <h3>Pembahasan Jawaban Salah</h3>
            <div id="review-section"></div>
        </div>
         
        <div style="text-align: center;">
           <button id="restart-btn" class="action-button">Ulangi Ujian</button>
        </div>
    </div>
    
    <!-- Modal Konfirmasi Selesai -->
    <div id="confirmation-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Selesaikan Ujian?</h2>
            <p>Apakah Anda yakin ingin menyelesaikan dan mengakhiri sesi ujian ini?</p>
            <div class="modal-actions">
                <button id="confirm-no" class="action-button">Batal</button>
                <button id="confirm-yes" class="action-button">Ya, Selesaikan</button>
            </div>
        </div>
    </div>


<script>
// --- DATABASE SOAL PPG PGSD ---
const questions = [
    // --- PENGUASAAN KONTEN (50 Soal) ---
    // Pedagogik
    { subtest: 'Penguasaan Konten', question: 'Seorang guru SD ingin menerapkan pembelajaran yang sesuai dengan prinsip konstruktivisme di kelas IV pada materi sifat-sifat cahaya. Kegiatan yang paling tepat untuk dilakukan adalah...', options: ['Guru menjelaskan semua sifat cahaya menggunakan slide presentasi dan video.', 'Siswa diminta membaca buku paket lalu merangkum sifat-sifat cahaya.', 'Guru melakukan demonstrasi percobaan sifat cahaya di depan kelas.', 'Siswa secara berkelompok melakukan serangkaian percobaan untuk menemukan sendiri sifat-sifat cahaya.'], answer: 'Siswa secara berkelompok melakukan serangkaian percobaan untuk menemukan sendiri sifat-sifat cahaya.', explanation: 'Prinsip utama konstruktivisme adalah siswa membangun pengetahuannya sendiri. Kegiatan percobaan secara mandiri memungkinkan siswa untuk aktif menemukan konsep, bukan hanya menerima informasi dari guru.' },
    { subtest: 'Penguasaan Konten', question: 'Penilaian yang dilakukan guru pada akhir suatu bab atau tema untuk mengukur penguasaan kompetensi siswa setelah proses pembelajaran selesai disebut...', options: ['Penilaian diagnostik', 'Penilaian formatif', 'Penilaian sumatif', 'Penilaian autentik'], answer: 'Penilaian sumatif', explanation: 'Penilaian sumatif bertujuan untuk menyimpulkan pencapaian siswa pada akhir periode pembelajaran (satu bab, satu semester) dan sering digunakan untuk menentukan nilai rapor.' },
    { subtest: 'Penguasaan Konten', question: 'Menurut teori perkembangan kognitif Piaget, siswa usia SD (7-11 tahun) berada pada tahap operasional konkret. Implikasi dari hal ini dalam pembelajaran adalah...', options: ['Pembelajaran harus selalu menggunakan benda-benda nyata atau media konkret.', 'Siswa sudah mampu berpikir abstrak dan hipotetis.', 'Fokus pembelajaran hanya pada pengembangan keterampilan motorik.', 'Siswa belajar paling baik melalui hafalan materi.'], answer: 'Pembelajaran harus selalu menggunakan benda-benda nyata atau media konkret.', explanation: 'Pada tahap operasional konkret, anak berpikir secara logis namun masih terikat pada objek atau kejadian yang konkret (nyata). Oleh karena itu, penggunaan media pembelajaran yang dapat dilihat dan dimanipulasi sangat penting.' },
    // Profesional: Matematika
    { subtest: 'Penguasaan Konten', question: 'FPB dan KPK dari bilangan 24, 36, dan 48 adalah...', options: ['FPB=12, KPK=144', 'FPB=6, KPK=72', 'FPB=12, KPK=72', 'FPB=6, KPK=144'], answer: 'FPB=12, KPK=144', explanation: 'Faktorisasi prima: 24=2³x3; 36=2²x3²; 48=2⁴x3. FPB (ambil faktor sama pangkat terkecil): 2²x3 = 12. KPK (ambil semua faktor pangkat terbesar): 2⁴x3² = 16x9 = 144.' },
    // Profesional: IPA
    { subtest: 'Penguasaan Konten', question: 'Proses perubahan wujud dari gas menjadi cair disebut mengembun. Peristiwa sehari-hari yang menunjukkan proses ini adalah...', options: ['Baju basah yang dijemur menjadi kering.', 'Terbentuknya titik-titik air di bagian luar gelas berisi es.', 'Kapur barus yang diletakkan di lemari menjadi habis.', 'Air yang direbus hingga mendidih mengeluarkan uap.'], answer: 'Terbentuknya titik-titik air di bagian luar gelas berisi es.', explanation: 'Udara di sekitar gelas yang dingin (mengandung uap air) melepaskan kalor ke gelas, sehingga wujudnya berubah dari gas (uap air) menjadi cair (titik-titik air).' },
    ...Array(45).fill({ subtest: 'Penguasaan Konten', question: 'Contoh Soal Konten Sulit: Seorang guru menemukan bahwa siswanya kesulitan memahami konsep volume balok. Berdasarkan teori Bruner, urutan tahapan pembelajaran yang paling efektif adalah...', options: ['Simbolik -> Ikonik -> Enaktif', 'Enaktif -> Ikonik -> Simbolik', 'Ikonik -> Simbolik -> Enaktif', 'Simbolik -> Enaktif -> Ikonik'], answer: 'Enaktif -> Ikonik -> Simbolik', explanation: 'Teori Bruner menyarankan urutan belajar dari pengalaman konkret (enaktif: menggunakan balok satuan), ke representasi gambar (ikonik: menggambar jaring-jaring balok), baru ke simbol abstrak (simbolik: menggunakan rumus p x l x t).' }),
    
    // --- KEMAMPUAN DASAR: LITERASI (25 Soal) ---
    { subtest: 'Literasi', question: 'Bacalah teks berikut! "Pemanasan global disebabkan oleh meningkatnya emisi gas rumah kaca. Gas-gas ini, seperti karbon dioksida, memerangkap panas di atmosfer, menyebabkan suhu bumi naik. Dampaknya sangat luas, mulai dari mencairnya es di kutub hingga perubahan pola cuaca ekstrem." | Apa gagasan utama paragraf tersebut?', options: ['Dampak perubahan pola cuaca.', 'Penyebab dan dampak pemanasan global.', 'Komposisi gas rumah kaca.', 'Proses mencairnya es di kutub.'], answer: 'Penyebab dan dampak pemanasan global.', explanation: 'Kalimat pertama menjelaskan penyebab (emisi gas rumah kaca), dan kalimat selanjutnya menjelaskan dampak (mencairnya es, perubahan cuaca). Ini merangkum keseluruhan isi paragraf.' },
    ...Array(24).fill({ subtest: 'Literasi', question: 'Contoh Soal Literasi Sulit: Perhatikan dua teks berikut! Teks 1: Berita tentang kenaikan kasus DBD di kota A. Teks 2: Iklan layanan masyarakat tentang 3M Plus. | Bagaimana kaitan antara kedua teks tersebut?', options: ['Teks 1 adalah akibat dari diabaikannya pesan pada Teks 2.', 'Teks 2 adalah solusi parsial untuk masalah yang digambarkan di Teks 1.', 'Teks 1 dan Teks 2 tidak memiliki hubungan sebab-akibat.', 'Teks 2 adalah sanggahan terhadap informasi di Teks 1.'], answer: 'Teks 2 adalah solusi parsial untuk masalah yang digambarkan di Teks 1.', explanation: 'Soal ini meminta kemampuan mengevaluasi dan menghubungkan informasi dari teks yang berbeda. Teks 2 (iklan 3M Plus) menawarkan solusi pencegahan untuk masalah yang diangkat di Teks 1 (kenaikan kasus DBD).' }),

    // --- KEMAMPUAN DASAR: NUMERASI (25 Soal) ---
    { subtest: 'Numerasi', question: 'Sebuah toko memberikan diskon 20% untuk semua produk. Jika harga sebuah baju setelah diskon adalah Rp 120.000, berapakah harga awal baju tersebut?', options: ['Rp 144.000', 'Rp 150.000', 'Rp 160.000', 'Rp 140.000'], answer: 'Rp 150.000', explanation: 'Harga setelah diskon adalah 80% (100% - 20%) dari harga awal. Maka, harga awal = Rp 120.000 / 80% = Rp 120.000 / 0,8 = Rp 150.000.' },
    ...Array(24).fill({ subtest: 'Numerasi', question: 'Contoh Soal Numerasi Sulit: Data infografis menunjukkan jumlah wisatawan ke pantai X meningkat 25% dari tahun 2022 ke 2023. Jika pada tahun 2023 jumlah wisatawan adalah 5.000 orang, berapa perkiraan jumlah wisatawan pada tahun 2022?', options: ['4.000 orang', '3.750 orang', '6.250 orang', '3.500 orang'], answer: '4.000 orang', explanation: 'Soal ini memerlukan pemikiran terbalik. Jumlah 2023 = 125% dari jumlah 2022. Maka, jumlah 2022 = 5.000 / 125% = 5.000 / 1.25 = 4.000 orang.' }),
];

// --- LOGIKA KUIS ---
document.addEventListener('DOMContentLoaded', () => {
    let currentQuestionIndex = 0;
    let userAnswers = new Array(questions.length).fill(null);
    let questionStatus = new Array(questions.length).fill('unanswered'); // unanswered, answered, doubtful
    let timerInterval;
    let currentUsername = '';

    // Element Cache
    const loginContainer = document.getElementById('login-container');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const loginBtn = document.getElementById('login-btn');
    const loginError = document.getElementById('login-error');

    const appHeader = document.querySelector('.header');
    const quizContainer = document.querySelector('.quiz-container');
    const resultPage = document.getElementById('result-page');
    
    const subtestTitleEl = document.getElementById('subtest-title');
    const questionNumberEl = document.getElementById('question-number');
    const questionTextEl = document.getElementById('question-text');
    const optionsEl = document.getElementById('options');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const doubtfulBtn = document.getElementById('doubtful-btn');
    const finishBtn = document.getElementById('finish-btn');
    const timerEl = document.getElementById('timer');
    const restartBtn = document.getElementById('restart-btn');
    const logoutBtn = document.getElementById('logout-btn');
    
    const confirmationModal = document.getElementById('confirmation-modal');
    const confirmYesBtn = document.getElementById('confirm-yes');
    const confirmNoBtn = document.getElementById('confirm-no');
    const headerInfo = document.getElementById('header-info');

    function showLoginPage() {
        loginContainer.style.display = 'flex';
        appHeader.style.display = 'none';
        quizContainer.style.display = 'none';
        resultPage.style.display = 'none';
        passwordInput.value = '';
        loginError.style.display = 'none';
    }

    function handleLogin() {
        const password = passwordInput.value;
        const username = usernameInput.value.trim();
        
        if (username === "") {
            loginError.textContent = "Username tidak boleh kosong.";
            loginError.style.display = 'block';
            return;
        }

        if (password === "ujiandiakazed.com") {
            currentUsername = username;
            loginContainer.style.display = 'none';
            appHeader.style.display = 'flex';
            quizContainer.style.display = 'flex';
            headerInfo.textContent = `Peserta: ${currentUsername}`;
            startQuiz();
        } else {
            loginError.textContent = "Password salah. Coba lagi.";
            loginError.style.display = 'block';
        }
    }
    
    function handleLogout() {
        clearInterval(timerInterval);
        showLoginPage();
    }

    function startQuiz() {
        currentQuestionIndex = 0;
        userAnswers.fill(null);
        questionStatus.fill('unanswered');
        quizContainer.style.display = 'flex';
        resultPage.style.display = 'none';
        
        setupQuestionGrids();
        displayQuestion(currentQuestionIndex);
        startTimer(150 * 60); // Waktu 150 Menit
    }

    function setupQuestionGrids() {
        const grids = {
            'Penguasaan Konten': document.getElementById('grid-konten'),
            'Literasi': document.getElementById('grid-literasi'),
            'Numerasi': document.getElementById('grid-numerasi')
        };
        Object.values(grids).forEach(grid => grid.innerHTML = '');

        questions.forEach((q, index) => {
            const button = document.createElement('button');
            button.className = 'grid-button';
            button.textContent = index + 1;
            button.onclick = () => jumpToQuestion(index);
            grids[q.subtest].appendChild(button);
        });
    }

    function displayQuestion(index) {
        document.querySelector('.grid-button.current')?.classList.remove('current');
        currentQuestionIndex = index;
        const question = questions[index];

        subtestTitleEl.textContent = question.subtest;
        questionNumberEl.textContent = index + 1;
        questionTextEl.innerHTML = question.question;
        optionsEl.innerHTML = '';

        question.options.forEach(option => {
            const li = document.createElement('li');
            const label = document.createElement('label');
            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = 'option';
            radio.value = option;
            
             if (userAnswers[index] === option) {
                radio.checked = true;
                label.classList.add('selected');
            }
            radio.onchange = () => selectAnswer(index, option);
            
            const span = document.createElement('span');
            span.textContent = option;
            
            label.appendChild(radio);
            label.appendChild(span);
            li.appendChild(label);
            optionsEl.appendChild(li);
        });

        updateNavButtons();
        updateGridButtonStatus(index);
        document.querySelectorAll('.question-grid-container button')[index].classList.add('current');
    }

    function selectAnswer(index, answer) {
        userAnswers[index] = answer;
        document.querySelectorAll('#options label').forEach(l => l.classList.remove('selected'));
        const escapedValue = CSS.escape(answer);
        const selectedLabel = document.querySelector(`input[value="${escapedValue}"]`);
        if (selectedLabel) {
            selectedLabel.parentElement.classList.add('selected');
        }

        if (questionStatus[index] !== 'doubtful') {
            questionStatus[index] = 'answered';
        }
        updateGridButtonStatus(index);
    }
    
    function updateNavButtons() {
        prevBtn.disabled = currentQuestionIndex === 0;
        nextBtn.disabled = currentQuestionIndex === questions.length - 1;
    }
    
    function updateGridButtonStatus(index) {
        const button = document.querySelectorAll('.question-grid-container button')[index];
        if (!button) return;
        
        button.classList.remove('answered', 'doubtful', 'unanswered');

        switch (questionStatus[index]) {
            case 'answered': button.classList.add('answered'); break;
            case 'doubtful': button.classList.add('doubtful'); break;
            default: button.classList.add('unanswered'); break;
        }
        document.querySelector('.grid-button.current')?.classList.remove('current');
        document.querySelectorAll('.question-grid-container button')[currentQuestionIndex].classList.add('current');
    }

    function jumpToQuestion(index) {
        displayQuestion(index);
    }

    function startTimer(duration) {
        let timer = duration;
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            let hours = parseInt(timer / 3600, 10);
            let minutes = parseInt((timer % 3600) / 60, 10);
            let seconds = parseInt(timer % 60, 10);

            hours = hours < 10 ? "0" + hours : hours;
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            timerEl.textContent = hours + ":" + minutes + ":" + seconds;
            
            if(timer < 300) timerEl.classList.add('low-time');

            if (--timer < 0) {
                clearInterval(timerInterval);
                finishQuiz();
            }
        }, 1000);
    }
    
    function showConfirmation() {
        confirmationModal.style.display = 'flex';
    }

    function finishQuiz() {
        clearInterval(timerInterval);
        confirmationModal.style.display = 'none';
        
        let score = 0;
        const subtestScores = {
            'Penguasaan Konten': { correct: 0, total: 0 },
            'Literasi': { correct: 0, total: 0 },
            'Numerasi': { correct: 0, total: 0 },
        };
        const correctQuestionNumbers = [];
        const incorrectQuestionNumbers = [];

        questions.forEach((q, index) => {
             if (subtestScores[q.subtest]) {
                subtestScores[q.subtest].total++;
                if (userAnswers[index] === q.answer) {
                    score++;
                    subtestScores[q.subtest].correct++;
                    correctQuestionNumbers.push(index + 1);
                } else {
                    incorrectQuestionNumbers.push(index + 1);
                }
            }
        });
        
        quizContainer.style.display = 'none';
        resultPage.style.display = 'block';
        appHeader.style.display = 'flex';
        headerInfo.textContent = `Hasil Ujian: ${currentUsername}`;
        
        const overallPercentage = ((score / questions.length) * 100).toFixed(1);
        document.getElementById('final-score').textContent = `${overallPercentage}%`;
        document.getElementById('score-details').textContent = `Benar ${score} dari ${questions.length} soal`;

        const subtestAnalysisContainer = document.getElementById('subtest-analysis-container');
        subtestAnalysisContainer.innerHTML = '';
        for (const key in subtestScores) {
            const subtest = subtestScores[key];
            const percentage = subtest.total > 0 ? ((subtest.correct / subtest.total) * 100).toFixed(1) : 0;
            subtestAnalysisContainer.innerHTML += `
                <div class="subtest-card">
                    <h4>${key}</h4>
                    <div class="subtest-score" style="color: ${percentage >= 50 ? 'var(--correct-text)' : 'var(--incorrect-text)'}">${percentage}%</div>
                    <div>${subtest.correct}/${subtest.total} Benar</div>
                </div>`;
        }
        
        document.getElementById('correct-list').innerHTML = correctQuestionNumbers.map(n => `<li class="correct">${n}</li>`).join('');
        document.getElementById('incorrect-list').innerHTML = incorrectQuestionNumbers.map(n => `<li class="incorrect">${n}</li>`).join('');

        const reviewSection = document.getElementById('review-section');
        reviewSection.innerHTML = '';
        if (incorrectQuestionNumbers.length > 0) {
            document.getElementById('review-section-container').style.display = 'block';
            incorrectQuestionNumbers.forEach(num => {
                const index = num - 1;
                const q = questions[index];
                const userAnswerText = userAnswers[index] || 'Tidak Dijawab';
                reviewSection.innerHTML += `
                    <div class="review-item">
                        <p class="review-q-text"><strong>Soal ${num}:</strong> ${q.question}</p>
                        <div class="review-answer user-answer">Jawaban Anda: ${userAnswerText}</div>
                        <div class="review-answer correct-answer">Jawaban Benar: ${q.answer}</div>
                        <div class="explanation"><strong>Pembahasan:</strong> ${q.explanation}</div>
                    </div>
                `;
            });
        } else {
            document.getElementById('review-section-container').style.display = 'none';
            reviewSection.innerHTML = '<p style="text-align:center; font-weight:500;">Luar biasa! Semua jawaban Anda benar.</p>';
        }
    }

    // Event Listeners
    loginBtn.addEventListener('click', handleLogin);
    passwordInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') handleLogin(); });
    logoutBtn.addEventListener('click', handleLogout);
    prevBtn.addEventListener('click', () => currentQuestionIndex > 0 && displayQuestion(currentQuestionIndex - 1));
    nextBtn.addEventListener('click', () => currentQuestionIndex < questions.length - 1 && displayQuestion(currentQuestionIndex + 1));
    doubtfulBtn.addEventListener('click', () => {
        questionStatus[currentQuestionIndex] = questionStatus[currentQuestionIndex] === 'doubtful' ? (userAnswers[currentQuestionIndex] ? 'answered' : 'unanswered') : 'doubtful';
        updateGridButtonStatus(currentQuestionIndex);
    });
    finishBtn.addEventListener('click', showConfirmation);
    confirmYesBtn.addEventListener('click', finishQuiz);
    confirmNoBtn.addEventListener('click', () => confirmationModal.style.display = 'none');
    restartBtn.addEventListener('click', startQuiz);

    // Initialize
    showLoginPage();
});
</script>
