
    <!-- SELURUH KONTEN HTML ANDA DARI SINI -->
    <div id="login-container">
        <div class="login-box">
            <h2>Login Peserta Ujian</h2>
            <div class="input-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Masukkan username Anda">
            </div>
            <div class="input-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Masukkan password">
            </div>
            <button id="login-btn">Masuk</button>
            <p id="login-error">Password salah. Coba lagi.</p>
            <a href="/ujian/cara-ikut-tryout-online-gratis" style="text-decoration: none;">
                <button id="cara-btn" type="button">Cara Ikut Try Out</button>
            </a>
        </div>
    </div>

    <header class="header" style="display: none;">
        <h2>Simulasi Ujian</h2>
        <div class="user-info">
            <span id="header-info"></span>
            <button id="logout-btn">Logout</button>
        </div>
        
    {{< adsense/display-ad >}}

    </header>

    <div class="quiz-container" style="display: none;">
        <main class="question-panel">
            <div class="question-header">
                <span id="subtest-title">Subtes</span> | Soal No. <span id="question-number">1</span>
            </div>
            <div class="question-body">
                <p id="question-text">Memuat soal...</p>
                <ul id="options" class="options-list"></ul>
            </div>
            <div class="quiz-actions">
                <button id="prev-btn" class="action-button">Sebelumnya</button>
                <button id="doubtful-btn" class="action-button">Ragu-ragu</button>
                <button id="next-btn" class="action-button">Selanjutnya</button>
            </div>
        </main>
        <aside class="navigation-panel">
            <div class="timer-box">
                Sisa Waktu
                <div id="timer">30:00</div>
            </div>
            <div id="grid-container" class="question-grid-container"></div>
            <div class="quiz-actions" style="justify-content: center;">
                <button id="finish-btn" class="action-button">Selesaikan Ujian</button>
            </div>
        </aside>
    </div>

    <div id="result-page" class="result-container" style="display: none;">
        <div class="result-card overall-summary">
            <div id="status-lulus" class="status"></div>
            <h2>Hasil Akhir Ujian</h2>
            <div id="final-score" class="score">0</div>
            <div id="score-details" class="score-details"></div>
            <div id="submission-status"></div>
        </div>
        <div class="result-card">
            <h3>Tinjauan Jawaban</h3>
            <div id="review-section"></div>
        </div>
        <div style="text-align: center;">
           <button id="restart-btn" class="action-button">Ulangi Ujian</button>
        </div>
    </div>
    
    <div id="confirmation-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Selesaikan Ujian?</h2>
            <p>Apakah Anda yakin ingin menyelesaikan dan mengakhiri sesi ujian ini?</p>
            <div class="modal-actions">
                <button id="confirm-no" class="action-button">Batal</button>
                <button id="confirm-yes" class="action-button">Ya, Selesaikan</button>
            </div>
        </div>
    </div>
    <!-- HINGGA AKHIR KONTEN HTML ANDA -->

<script>
// ===================================================================================
// --- KONFIGURASI UJIAN (HANYA UBAH BAGIAN INI UNTUK UJIAN BARU) ---
// ===================================================================================
const EXAM_CONFIG = {
    // 1. Ganti nama kategori ini sesuai nama sheet di Google Sheets (cth: "TWK", "TKP")
    kategori: "BUMN",
    
    // 2. Ganti URL ini dengan URL Web App dari Google Script Anda yang sudah di-deploy ulang.
    scriptURL: 'https://script.google.com/macros/s/AKfycbxNJ9pOsCPSPAPRQKfoq43AwmVMSIScq6AIa33Q0dxnMI-jb1xuxi1aK3bUBFDstinDiQ/exec',
    
    // 3. Ganti link peringkat ini ke halaman peringkat yang sesuai.
    linkPeringkat: "/ujian/ranking-peserta-tryout/",
    
    // 4. Sesuaikan pengaturan ujian jika perlu.
    durasiMenit: 30,
    passingGrade: 50,
    password: "ujian",
    
    // 5. Ganti seluruh isi bank soal di bawah ini dengan soal yang sesuai.
    bankSoal: [
  // --- TES KEMAMPUAN VERBAL (ANALOGI) - 20 Soal ---
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'PILOT : PESAWAT',
    options: ['Kusir : Kereta', 'Masinis : Stasiun', 'Nelayan : Laut', 'Petani : Traktor', 'Sopir : Terminal'],
    answer: 'Petani : Traktor',
    explanation: 'Hubungannya adalah "profesi : alat/kendaraan yang digunakan". Pilot menggunakan Pesawat, sama seperti Petani menggunakan Traktor.'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'ULAT : KEPOMPONG : KUPU-KUPU',
    options: ['Pagi : Siang : Sore', 'Bayi : Anak-anak : Remaja', 'Kecil : Sedang : Besar', 'Telur : Jentik : Nyamuk', 'Belajar : Ujian : Lulus'],
    answer: 'Telur : Jentik : Nyamuk',
    explanation: 'Hubungannya adalah urutan metamorfosis atau siklus hidup. Urutan Ulat -> Kepompong -> Kupu-kupu, setara dengan urutan Telur -> Jentik -> Nyamuk.'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'API : PANAS',
    options: ['Es : Beku', 'Gunung : Kabut', 'Air : Mendidih', 'Listrik : Terang', 'Salju : Dingin'],
    answer: 'Salju : Dingin',
    explanation: 'Hubungannya adalah "benda : sifat/karakteristik utamanya". Api memiliki sifat Panas, sama seperti Salju memiliki sifat Dingin.'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'LAPAR : MAKAN',
    options: ['Sakit : Obat', 'Mengantuk : Tidur', 'Buku : Baca', 'Lelah : Istirahat', 'Haus : Dahaga'],
    answer: 'Mengantuk : Tidur',
    explanation: 'Hubungannya adalah "kondisi yang dirasakan : tindakan untuk mengatasinya". Jika Lapar, solusinya adalah Makan. Jika Mengantuk, solusinya adalah Tidur.'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'KAYU : POHON',
    options: ['Emas : Tambang', 'Bata : Tanah Liat', 'Buku : Kertas', 'Roti : Gandum', 'Air : Laut'],
    answer: 'Emas : Tambang',
    explanation: 'Hubungannya adalah "hasil : sumber asalnya". Kayu berasal dari Pohon, sama seperti Emas berasal dari Tambang.'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'GURU : SEKOLAH',
    options: ['Dokter : Apotek', 'Penyanyi : Panggung', 'Petani : Sawah', 'Aktor : Televisi', 'Nelayan : Kapal'],
    answer: 'Petani : Sawah',
    explanation: 'Hubungannya adalah "profesi : tempat kerja utamanya". Guru bekerja di Sekolah, sama seperti Petani bekerja di Sawah.'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'INDONESIA : JAKARTA',
    options: ['Malaysia : Kuala Lumpur', 'Filipina : Bangkok', 'Australia : Sydney', 'Amerika Serikat : New York', 'Jepang : Kyoto'],
    answer: 'Malaysia : Kuala Lumpur',
    explanation: 'Hubungannya adalah "negara : ibu kotanya". Ibu kota Indonesia adalah Jakarta, sama seperti ibu kota Malaysia adalah Kuala Lumpur.'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'UMUM : LAZIM',
    options: ['Kurus : Gemuk', 'Kosong : Hampa', 'Cinta : Benci', 'Langsing : Ramping', 'Cepat : Lambat'],
    answer: 'Langsing : Ramping',
    explanation: 'Hubungannya adalah sinonim atau persamaan kata. Umum memiliki arti yang sama dengan Lazim, sama seperti Langsing memiliki arti yang sama dengan Ramping.'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'RODA : MOBIL',
    options: ['Daun : Ranting', 'Jari : Tangan', 'Mesin : Bensin', 'Rumah : Pintu', 'Air : Ember'],
    answer: 'Rumah : Pintu',
    explanation: 'Hubungannya adalah "keseluruhan : bagiannya". Mobil memiliki bagian yaitu Roda, sama seperti Rumah memiliki bagian yaitu Pintu. Pilihan B terbalik (bagian : keseluruhan).'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'MATA : TELINGA',
    options: ['Jari : Tangan', 'Kaki : Tangan', 'Hidung : Pipi', 'Lidah : Hidung', 'Perut : Dada'],
    answer: 'Lidah : Hidung',
    explanation: 'Hubungannya adalah "anggota panca indra". Mata dan Telinga adalah sama-sama panca indra, sama seperti Lidah dan Hidung yang juga panca indra.'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'AIR : HAUS',
    options: ['Nasi : Lapar', 'Angin : Panas', 'Minyak : Api', 'Obat : Sakit', 'Gelap : Lampu'],
    answer: 'Nasi : Lapar',
    explanation: 'Hubungannya adalah "sesuatu yang dibutuhkan : kondisi yang membutuhkan". Air dibutuhkan saat Haus, sama seperti Nasi dibutuhkan saat Lapar.'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'KEUNTUNGAN : PENJUALAN',
    options: ['Kemasyhuran : Keberanian', 'Ketenaran : Pelanggaran', 'Jabatan : Pengabdian', 'Prestasi : Latihan', 'Kesehatan : Dokter'],
    answer: 'Kemasyhuran : Keberanian',
    explanation: 'Hubungannya adalah "akibat : sebab". Keuntungan didapat dari Penjualan, sama seperti Kemasyhuran (keterkenalan) didapat dari Keberanian (melakukan sesuatu yang hebat).'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'BUNGA : VAS',
    options: ['Air : Pipa', 'Buku : Rak', 'Pakaian : Lemari', 'Rumah : Atap', 'Pensil : Kotak Pensil'],
    answer: 'Pensil : Kotak Pensil',
    explanation: 'Hubungannya adalah "benda : tempat penyimpanan spesifiknya". Bunga diletakkan di Vas, sama seperti Pensil diletakkan di Kotak Pensil.'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'RAMALAN : ASTROLOGI',
    options: ['Penyakit : Psikologi', 'Bangsa : Etnologi', 'Masyarakat : Antropologi', 'Bintang : Astronomi', 'Hukum : Kriminologi'],
    answer: 'Bangsa : Etnologi',
    explanation: 'Hubungannya adalah "objek studi : ilmu yang mempelajarinya". Ramalan adalah objek studi Astrologi, sama seperti Bangsa adalah objek studi Etnologi.'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'FIKTIF >< FAKTA',
    options: ['DONGENG >< PERISTIWA', 'DUSTA >< KEBENARAN', 'PREDIKSI >< REALITA', 'MAYA >< NYATA', 'HIPOTESIS >< TEORI'],
    answer: 'DONGENG >< PERISTIWA',
    explanation: 'Hubungannya adalah antonim atau lawan kata. Fiktif (rekaan) berlawanan dengan Fakta (kenyataan), sama seperti Dongeng (cerita rekaan) berlawanan dengan Peristiwa (kejadian nyata).'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'KARET : GETAH',
    options: ['Tebu : Gula', 'Kelapa : Santan', 'Bensin : Minyak Bumi', 'Bata : Semen', 'Kertas : Buku'],
    answer: 'Kelapa : Santan',
    explanation: 'Hubungannya adalah "produk olahan : bahan mentah cairnya". Karet diolah dari Getah, sama seperti Santan diolah dari Kelapa.'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'BAWANG : SIUNG',
    options: ['Buku : Lembar', 'Pakaian : Kancing', 'Telur : Butir', 'Kain : Meter', 'Padi : Gabah'],
    answer: 'Telur : Butir',
    explanation: 'Hubungannya adalah "nama benda : kata satuan untuk menghitungnya". Satuan untuk Bawang adalah Siung, sama seperti satuan untuk Telur adalah Butir.'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'KOMPOR : API',
    options: ['Kipas : Angin', 'Lampu : Listrik', 'Jalan : Macet', 'Lemari : Es', 'Radio : Suara'],
    answer: 'Kipas : Angin',
    explanation: 'Hubungannya adalah "alat : sesuatu yang dihasilkannya". Kompor menghasilkan Api (panas), sama seperti Kipas menghasilkan Angin.'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'DERMAWAN : KIKIR',
    options: ['Baik : Jahat', 'Ramah : Sopan', 'Cerdas : Pandai', 'Optimis : Pesimis', 'Rajin : Giat'],
    answer: 'Optimis : Pesimis',
    explanation: 'Hubungannya adalah antonim atau lawan kata. Dermawan (suka memberi) adalah lawan dari Kikir (pelit), sama seperti Optimis adalah lawan dari Pesimis.'
  },
  {
    subtest: 'Tes Kemampuan Verbal (Analogi)',
    question: 'GELOMBANG : OMBAK',
    options: ['Gunung : Bukit', 'Danau : Laut', 'Hutan : Pohon', 'Semenanjung : Tanjung', 'Benua : Pulau'],
    answer: 'Gunung : Bukit',
    explanation: 'Hubungannya adalah "bentuk yang besar : bentuk yang lebih kecil dengan karakteristik serupa". Gelombang adalah versi besar dari Ombak, sama seperti Gunung adalah versi besar dari Bukit.'
  }
],

    // --- Data dinamis ini tidak perlu diubah ---
    judulHalaman: document.title,
    url: window.location.href
};

// ===================================================================================
// --- FUNGSI PENGIRIMAN DATA KE GOOGLE SHEET (DIPERBARUI) ---
// ===================================================================================
async function kirimKeGoogleSheet(data) {
    const statusEl = document.getElementById('submission-status');
    statusEl.textContent = 'Mengirim hasil ujian...';
    
    const formData = new FormData();
    // Menambahkan semua data ke dalam objek FormData.
    formData.append('kategori', data.kategori);
    formData.append('url', data.url);
    formData.append('judulHalaman', data.judulHalaman);
    formData.append('Nama', data.Nama);
    formData.append('JumlahSoal', data.JumlahSoal);
    formData.append('JawabanBenar', data.JawabanBenar);
    formData.append('JawabanSalah', data.JawabanSalah);
    formData.append('TidakDijawab', data.TidakDijawab);
    formData.append('Durasi', data.Durasi);
    formData.append('Nilai', data.Nilai);
    formData.append('StatusKelulusan', data.StatusKelulusan);

    try {
        const response = await fetch(EXAM_CONFIG.scriptURL, {
            method: 'POST',
            body: formData
        });
        
        // Membaca respons sebagai JSON untuk mendapatkan pesan sukses/error dari server
        const result = await response.json();
        
        if (result.result === "success") {
            statusEl.innerHTML = `Hasil ujian berhasil disimpan. <b><a href="${EXAM_CONFIG.linkPeringkat}">Cek Peringkat kamu di sini</a></b>`;
            statusEl.style.color = 'green';
        } else {
            // Menampilkan pesan error yang lebih spesifik dari server
            throw new Error(result.message || 'Terjadi kesalahan dari server.');
        }
    } catch (error) {
        console.error('Error saat mengirim ke Google Sheet:', error);
        statusEl.textContent = `Gagal menyimpan hasil. Coba lagi nanti. Error: ${error.message}`;
        statusEl.style.color = 'red';
    }
}

// ===================================================================================
// --- LOGIKA UTAMA UJIAN (DISESUAIKAN, TIDAK PERLU DIUBAH LAGI) ---
// ===================================================================================
document.addEventListener('DOMContentLoaded', () => {
    // Menggunakan bank soal dari EXAM_CONFIG
    const questions = EXAM_CONFIG.bankSoal;
    let currentQuestionIndex = 0;
    let userAnswers = new Array(questions.length).fill(null);
    let questionStatus = new Array(questions.length).fill('unanswered');
    let timerInterval;
    let startTime;
    let currentUsername = '';

    const loginContainer = document.getElementById('login-container');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const loginBtn = document.getElementById('login-btn');
    const loginError = document.getElementById('login-error');
    const appHeader = document.querySelector('.header');
    const quizContainer = document.querySelector('.quiz-container');
    const resultPage = document.getElementById('result-page');
    const subtestTitleEl = document.getElementById('subtest-title');
    const questionNumberEl = document.getElementById('question-number');
    const questionTextEl = document.getElementById('question-text');
    const optionsEl = document.getElementById('options');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const doubtfulBtn = document.getElementById('doubtful-btn');
    const finishBtn = document.getElementById('finish-btn');
    const timerEl = document.getElementById('timer');
    const restartBtn = document.getElementById('restart-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const headerInfo = document.getElementById('header-info');
    const confirmationModal = document.getElementById('confirmation-modal');
    const confirmYesBtn = document.getElementById('confirm-yes');
    const confirmNoBtn = document.getElementById('confirm-no');
    
    function showLoginPage() {
        loginContainer.style.display = 'block'; // Diubah dari 'flex' agar sesuai skrip asli
        appHeader.style.display = 'none';
        quizContainer.style.display = 'none';
        resultPage.style.display = 'none';
        passwordInput.value = '';
        loginError.style.display = 'none';
    }

    function handleLogin() {
        const password = passwordInput.value;
        const username = usernameInput.value.trim();
        if (username === "") {
            loginError.textContent = "Username tidak boleh kosong.";
            loginError.style.display = 'block';
            return;
        }
        // Menggunakan password dari EXAM_CONFIG
        if (password === EXAM_CONFIG.password) {
            currentUsername = username;
            loginContainer.style.display = 'none';
            appHeader.style.display = 'flex';
            quizContainer.style.display = 'flex';
            resultPage.style.display = 'none';
            headerInfo.textContent = `Peserta: ${currentUsername}`;
            startQuiz();
        } else {
            loginError.textContent = "Password salah. Coba lagi.";
            loginError.style.display = 'block';
        }
    }
    
    function handleLogout() {
        clearInterval(timerInterval);
        showLoginPage();
    }

    function startQuiz() {
        currentQuestionIndex = 0;
        userAnswers.fill(null);
        questionStatus.fill('unanswered');
        quizContainer.style.display = 'flex';
        resultPage.style.display = 'none';
        setupQuestionGrids();
        displayQuestion(currentQuestionIndex);
        // Menggunakan durasi dari EXAM_CONFIG
        startTimer(EXAM_CONFIG.durasiMenit * 60);
        startTime = new Date();
    }

    function setupQuestionGrids() {
        const gridContainer = document.getElementById('grid-container');
        gridContainer.innerHTML = '';
        const subtests = [...new Set(questions.map(q => q.subtest))];
        subtests.forEach(subtest => {
            const group = document.createElement('div');
            group.className = 'subtest-group';
            const title = document.createElement('h3');
            title.textContent = subtest;
            const grid = document.createElement('div');
            grid.className = 'question-grid';
            group.appendChild(title);
            group.appendChild(grid);
            gridContainer.appendChild(group);
            questions.forEach((q, index) => {
                if (q.subtest === subtest) {
                    const button = document.createElement('button');
                    button.className = 'grid-button';
                    button.textContent = index + 1;
                    button.onclick = () => jumpToQuestion(index);
                    grid.appendChild(button);
                }
            });
        });
    }

    function displayQuestion(index) {
        document.querySelector('.grid-button.current')?.classList.remove('current');
        currentQuestionIndex = index;
        const question = questions[index];
        subtestTitleEl.textContent = question.subtest;
        questionNumberEl.textContent = index + 1;
        questionTextEl.innerHTML = question.question;
        optionsEl.innerHTML = '';
        question.options.forEach(option => {
            const li = document.createElement('li');
            const label = document.createElement('label');
            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = `option-${index}`;
            radio.value = option;
            if (userAnswers[index] === option) {
                radio.checked = true;
                label.classList.add('selected');
            }
            radio.onchange = () => selectAnswer(index, option, label);
            const span = document.createElement('span');
            span.innerHTML = option; // Menggunakan innerHTML untuk render jika ada format
            label.appendChild(radio);
            label.appendChild(span);
            li.appendChild(label);
            optionsEl.appendChild(li);
        });
        updateNavButtons();
        updateGridButtonStatus(index, true);
    }

    function selectAnswer(index, answer, label) {
        userAnswers[index] = answer;
        document.querySelectorAll(`#options li label`).forEach(l => l.classList.remove('selected'));
        label.classList.add('selected');
        if (questionStatus[index] !== 'doubtful') {
            questionStatus[index] = 'answered';
        }
        updateGridButtonStatus(index);
    }
    
    function updateNavButtons() {
        prevBtn.disabled = currentQuestionIndex === 0;
        nextBtn.disabled = currentQuestionIndex === questions.length - 1;
    }
    
    function updateGridButtonStatus(index, isCurrent = false) {
        const allGridButtons = document.querySelectorAll('.grid-button');
        if (isCurrent) {
            const currentBtn = document.querySelector('.grid-button.current');
            if (currentBtn) currentBtn.classList.remove('current');
        }
        const button = Array.from(allGridButtons).find(btn => parseInt(btn.textContent) === index + 1);
        if (!button) return;
        if(isCurrent) button.classList.add('current');
        button.classList.remove('answered', 'doubtful');
        switch (questionStatus[index]) {
            case 'answered': button.classList.add('answered'); break;
            case 'doubtful': button.classList.add('doubtful'); break;
        }
    }

    function jumpToQuestion(index) {
        displayQuestion(index);
    }

    function startTimer(duration) {
        let timer = duration;
        clearInterval(timerInterval);
        timerEl.parentElement.classList.remove('low-time');
        timerInterval = setInterval(() => {
            let minutes = parseInt(timer / 60, 10);
            let seconds = parseInt(timer % 60, 10);
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;
            timerEl.textContent = `${minutes}:${seconds}`;
            if (timer < 300 && !timerEl.parentElement.classList.contains('low-time')) { 
                timerEl.parentElement.classList.add('low-time'); 
            }
            if (--timer < 0) {
                clearInterval(timerInterval);
                finishQuiz();
            }
        }, 1000);
    }
    
    function showConfirmation() {
        confirmationModal.style.display = 'flex';
    }

    function formatDuration(ms) {
    const totalSeconds = Math.floor(ms / 1000);
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    return `${minutes} menit ${seconds.toString().padStart(2, '0')} detik`;
}


    function finishQuiz() {
        clearInterval(timerInterval);
        confirmationModal.style.display = 'none';
        const endTime = new Date();
        const durationMs = endTime - startTime;
        let correctCount = 0;
        questions.forEach((q, index) => {
            if (userAnswers[index] === q.answer) correctCount++;
        });
        const totalQuestions = questions.length;
        const answeredCount = userAnswers.filter(a => a !== null).length;
        const incorrectCount = answeredCount - correctCount;
        const unansweredCount = totalQuestions - answeredCount;
        const finalScore = totalQuestions > 0 ? parseFloat(((correctCount / totalQuestions) * 100).toFixed(2)) : 0;
        const isPassed = finalScore >= EXAM_CONFIG.passingGrade;
        
        quizContainer.style.display = 'none';
        resultPage.style.display = 'block';
        headerInfo.textContent = `Hasil Ujian: ${currentUsername}`;
        
        const statusEl = document.getElementById('status-lulus');
        statusEl.textContent = isPassed ? 'SELAMAT, ANDA LULUS!' : 'MAAF, ANDA BELUM LULUS';
        statusEl.className = `status ${isPassed ? 'lulus' : 'gagal'}`;
        document.getElementById('final-score').textContent = finalScore;
        document.getElementById('score-details').textContent = `${correctCount} dari ${totalQuestions} soal benar`;
        
        const reviewSection = document.getElementById('review-section');
        reviewSection.innerHTML = '';
        questions.forEach((q, index) => {
            const userAnswer = userAnswers[index];
            const isCorrect = userAnswer === q.answer;
            reviewSection.innerHTML += `
                <div class="review-item">
                    <p><strong>Soal ${index + 1}:</strong> ${q.question}</p>
                    <div class="review-answer user-answer ${isCorrect ? '' : 'is-incorrect'}">Jawaban Anda: ${userAnswer || 'Tidak Dijawab'}</div>
                    ${!isCorrect ? `<div class="review-answer correct-answer">Jawaban Benar: ${q.answer}</div>` : ''}
                    <div class="explanation"><strong>Pembahasan:</strong> ${q.explanation}</div>
                </div>
            `;
        });
        
        const dataForSheet = {
            kategori: EXAM_CONFIG.kategori,
            url: EXAM_CONFIG.url,
            judulHalaman: EXAM_CONFIG.judulHalaman,
            Nama: currentUsername,
            JumlahSoal: totalQuestions,
            JawabanBenar: correctCount,
            JawabanSalah: incorrectCount,
            TidakDijawab: unansweredCount,
            Durasi: formatDuration(durationMs),
            Nilai: finalScore,
            StatusKelulusan: isPassed ? 'Lulus' : 'Tidak Lulus'
        };
        kirimKeGoogleSheet(dataForSheet);
    }

    // Event Listeners
    loginBtn.addEventListener('click', handleLogin);
    passwordInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') handleLogin(); });
    logoutBtn.addEventListener('click', handleLogout);
    prevBtn.addEventListener('click', () => { if (currentQuestionIndex > 0) displayQuestion(currentQuestionIndex - 1) });
    nextBtn.addEventListener('click', () => { if (currentQuestionIndex < questions.length - 1) displayQuestion(currentQuestionIndex + 1) });
    doubtfulBtn.addEventListener('click', () => {
        const currentStatus = questionStatus[currentQuestionIndex];
        if (currentStatus === 'doubtful') {
            questionStatus[currentQuestionIndex] = userAnswers[currentQuestionIndex] ? 'answered' : 'unanswered';
        } else {
            questionStatus[currentQuestionIndex] = 'doubtful';
        }
        updateGridButtonStatus(currentQuestionIndex);
    });
    finishBtn.addEventListener('click', showConfirmation);
    confirmYesBtn.addEventListener('click', finishQuiz);
    confirmNoBtn.addEventListener('click', () => confirmationModal.style.display = 'none');
    restartBtn.addEventListener('click', handleLogout);

    showLoginPage();
});
</script>
