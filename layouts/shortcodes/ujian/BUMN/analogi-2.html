
    <!-- SELURUH KONTEN HTML ANDA DARI SINI -->
    <div id="login-container">
        <div class="login-box">
            <h2>Login Peserta Ujian</h2>
            <div class="input-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Masukkan username Anda">
            </div>
            <div class="input-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Masukkan password">
            </div>
            <button id="login-btn">Masuk</button>
            <p id="login-error">Password salah. Coba lagi.</p>
            <a href="/ujian/cara-ikut-tryout-online-gratis" style="text-decoration: none;">
                <button id="cara-btn" type="button">Cara Ikut Try Out</button>
            </a>
        </div>
    </div>

    <header class="header" style="display: none;">
        <h2>Simulasi Ujian</h2>
        <div class="user-info">
            <span id="header-info"></span>
            <button id="logout-btn">Logout</button>
        </div>
    </header>

    <div class="quiz-container" style="display: none;">
        <main class="question-panel">
            <div class="question-header">
                <span id="subtest-title">Subtes</span> | Soal No. <span id="question-number">1</span>
            </div>
            <div class="question-body">
                <p id="question-text">Memuat soal...</p>
                <ul id="options" class="options-list"></ul>
            </div>
            <div class="quiz-actions">
                <button id="prev-btn" class="action-button">Sebelumnya</button>
                <button id="doubtful-btn" class="action-button">Ragu-ragu</button>
                <button id="next-btn" class="action-button">Selanjutnya</button>
            </div>
        </main>
        <aside class="navigation-panel">
            <div class="timer-box">
                Sisa Waktu
                <div id="timer">30:00</div>
            </div>
            <div id="grid-container" class="question-grid-container"></div>
            <div class="quiz-actions" style="justify-content: center;">
                <button id="finish-btn" class="action-button">Selesaikan Ujian</button>
            </div>
        </aside>
    </div>

    <div id="result-page" class="result-container" style="display: none;">
        <div class="result-card overall-summary">
            <div id="status-lulus" class="status"></div>
            <h2>Hasil Akhir Ujian</h2>
            <div id="final-score" class="score">0</div>
            <div id="score-details" class="score-details"></div>
            <div id="submission-status"></div>
        </div>
        <div class="result-card">
            <h3>Tinjauan Jawaban</h3>
            <div id="review-section"></div>
        </div>
        <div style="text-align: center;">
           <button id="restart-btn" class="action-button">Ulangi Ujian</button>
        </div>
    </div>
    
    <div id="confirmation-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Selesaikan Ujian?</h2>
            <p>Apakah Anda yakin ingin menyelesaikan dan mengakhiri sesi ujian ini?</p>
            <div class="modal-actions">
                <button id="confirm-no" class="action-button">Batal</button>
                <button id="confirm-yes" class="action-button">Ya, Selesaikan</button>
            </div>
        </div>
    </div>
    <!-- HINGGA AKHIR KONTEN HTML ANDA -->

<script>
// ===================================================================================
// --- KONFIGURASI UJIAN (HANYA UBAH BAGIAN INI UNTUK UJIAN BARU) ---
// ===================================================================================
const EXAM_CONFIG = {
    // 1. Ganti nama kategori ini sesuai nama sheet di Google Sheets (cth: "TWK", "TKP")
    kategori: "BUMN",
    
    // 2. Ganti URL ini dengan URL Web App dari Google Script Anda yang sudah di-deploy ulang.
    scriptURL: 'https://script.google.com/macros/s/AKfycbxNJ9pOsCPSPAPRQKfoq43AwmVMSIScq6AIa33Q0dxnMI-jb1xuxi1aK3bUBFDstinDiQ/exec',
    
    // 3. Ganti link peringkat ini ke halaman peringkat yang sesuai.
    linkPeringkat: "/ujian/ranking-peserta-tryout/",
    
    // 4. Sesuaikan pengaturan ujian jika perlu.
    durasiMenit: 30,
    passingGrade: 50,
    password: "ujian",
    
    // 5. Ganti seluruh isi bank soal di bawah ini dengan soal yang sesuai.
    bankSoal: [
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "GELAP : TERANG",
    "options": ["Basah : Lembab", "Siang : Malam", "Tinggi : Jauh", "Manis : Pahit", "Benar : Betul"],
    "answer": "Manis : Pahit",
    "explanation": "Hubungannya adalah lawan kata (antonim). Gelap adalah lawan kata dari Terang, sama seperti Manis adalah lawan kata dari Pahit. Opsi 'Siang : Malam' juga antonim, namun urutannya terbalik."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "SISWA : BELAJAR : KELAS",
    "options": ["Dokter : Merawat : Pasien", "Petani : Mencangkul : Sawah", "Koki : Panci : Dapur", "Atlet : Medali : Stadion", "Pilot : Terbang : Bandara"],
    "answer": "Petani : Mencangkul : Sawah",
    "explanation": "Hubungannya adalah 'subjek : aktivitas : tempat'. Siswa melakukan aktivitas Belajar di Kelas, sama seperti Petani melakukan aktivitas Mencangkul di Sawah."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "AIR : HAUS",
    "options": ["Makanan : Lapar", "Angin : Gerah", "Obat : Sakit", "Buku : Bodoh", "Api : Dingin"],
    "answer": "Makanan : Lapar",
    "explanation": "Hubungannya adalah 'sesuatu yang dibutuhkan untuk mengatasi kondisi'. Air dibutuhkan untuk mengatasi Haus, sama seperti Makanan dibutuhkan untuk mengatasi Lapar."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "MATAHARI : BUMI",
    "options": ["Bulan : Satelit", "Bumi : Mars", "Inti : Atom", "Roda : Mobil", "Jari : Tangan"],
    "answer": "Inti : Atom",
    "explanation": "Hubungannya adalah 'pusat : yang mengelilingi'. Bumi mengelilingi Matahari sebagai pusat tata surya, sama seperti elektron (bagian dari atom) mengelilingi Inti Atom."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "UMUR : TAHUN",
    "options": ["Kertas : Helai", "Ilmu : Nilai", "Jam : Detik", "Kecepatan : Jarak", "Kain : Meter"],
    "answer": "Kain : Meter",
    "explanation": "Hubungannya adalah 'besaran : satuan ukur'. Umur diukur dengan satuan Tahun, sama seperti Kain diukur dengan satuan Meter. 'Jam : Detik' adalah satuan waktu, tetapi jam sendiri adalah satuan, bukan besaran."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "SEMINAR : SARJANA",
    "options": ["Perpustakaan : Peneliti", "Akademi : Taruna", "Rumah Sakit : Pasien", "Panggung : Aktor", "Ruang Sidang : Terdakwa"],
    "answer": "Akademi : Taruna",
    "explanation": "Hubungannya adalah 'tempat pendidikan/kegiatan : pesertanya'. Seminar adalah kegiatan yang sering diikuti Sarjana, sama seperti Akademi adalah tempat pendidikan bagi Taruna."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "METAMORFOSIS : ULAT",
    "options": ["Evolusi : Manusia", "Regenerasi : Sel", "Fotosintesis : Tumbuhan", "Metabolisme : Enzim", "Presipitasi : Hujan"],
    "answer": "Regenerasi : Sel",
    "explanation": "Hubungannya adalah 'proses biologis : objek yang mengalami'. Metamorfosis adalah proses yang dialami Ulat, sama seperti Regenerasi adalah proses yang dialami Sel."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "LAPAROSKOPI : BEDAH",
    "options": ["Stetoskop : Diagnosis", "Teleskop : Astronomi", "Endoskopi : Pencernaan", "Mikroskop : Bakteriologi", "Laringoskop : THT"],
    "answer": "Endoskopi : Pencernaan",
    "explanation": "Hubungannya adalah 'alat/teknik : bidang medis spesifik'. Laparoskopi adalah teknik untuk Bedah perut, sama seperti Endoskopi adalah teknik untuk memeriksa organ Pencernaan."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "FIKTIF : FAKTA",
    "options": ["Dongeng : Peristiwa", "Hipotesis : Teori", "Prediksi : Ramalan", "Dusta : Kebenaran", "Opini : Argumen"],
    "answer": "Dusta : Kebenaran",
    "explanation": "Hubungannya adalah 'sesuatu yang tidak nyata : sesuatu yang nyata/benar'. Fiktif berlawanan dengan Fakta, sama seperti Dusta berlawanan dengan Kebenaran."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "SUARA : GEMA",
    "options": ["Cahaya : Bayangan", "Aksi : Reaksi", "Panas : Api", "Pukul : Sakit", "Lempar : Tangkap"],
    "answer": "Aksi : Reaksi",
    "explanation": "Hubungannya adalah 'sebab : akibat yang merupakan pantulan/balasan'. Gema adalah pantulan dari Suara, sama seperti Reaksi adalah balasan dari sebuah Aksi (Hukum Newton III)."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "PIANO : ORGAN",
    "options": ["Biola : Gitar", "Drum : Gendang", "Nada : Irama", "Gitar : Ukulele", "Seruling : Terompet"],
    "answer": "Gitar : Ukulele",
    "explanation": "Hubungannya adalah 'alat musik : versi yang lebih kecil/sederhana dengan cara main mirip'. Organ adalah versi lebih kompleks dari Piano (keduanya keyboard), sama seperti Ukulele adalah versi lebih kecil dari Gitar (keduanya dipetik)."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "BAWANG : SIUNG",
    "options": ["Padi : Butir", "Buku : Lembar", "Kain : Meter", "Telur : Butir", "Pakaian : Kodi"],
    "answer": "Pakaian : Kodi",
    "explanation": "Hubungannya adalah 'benda : satuan hitung kolektif/kelompok'. Bawang dihitung dalam Siung, sama seperti Pakaian dihitung dalam Kodi."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "HUTAN : POHON",
    "options": ["Gurun : Pasir", "Laut : Garam", "Papan : Kayu", "Buku : Kertas", "Tembok : Batu Bata"],
    "answer": "Tembok : Batu Bata",
    "explanation": "Hubungannya adalah 'keseluruhan : komponen penyusun utama'. Hutan tersusun dari banyak Pohon, sama seperti Tembok tersusun dari banyak Batu Bata. 'Gurun : Pasir' mirip, tetapi pasir adalah material, bukan komponen terstruktur seperti pohon atau batu bata."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "KANTUK : TIDUR",
    "options": ["Mimpi : Bangun", "Lapar : Makan", "Haus : Minum", "Sakit : Obat", "Senang : Tawa"],
    "answer": "Senang : Tawa",
    "explanation": "Hubungannya adalah 'kondisi perasaan/keadaan : ekspresi/tindakan yang diakibatkan'. Kantuk mengakibatkan tindakan Tidur, sama seperti perasaan Senang mengakibatkan ekspresi Tawa."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "DERMATOLOGI : KULIT",
    "options": ["Kardiologi : Jantung", "Biologi : Hewan", "Geologi : Geografi", "Farmakologi : Apoteker", "Psikologi : Psikiater"],
    "answer": "Kardiologi : Jantung",
    "explanation": "Hubungannya adalah 'cabang ilmu kedokteran : organ yang dipelajari'. Dermatologi adalah ilmu tentang Kulit, sama seperti Kardiologi adalah ilmu tentang Jantung."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "PREAMBUL : KONSTITUSI",
    "options": ["Prolog : Drama", "Sinopsis : Novel", "Abstrak : Skripsi", "Pendahuluan : Buku", "Judul : Bab"],
    "answer": "Prolog : Drama",
    "explanation": "Hubungannya adalah 'bagian pembuka : keseluruhan karya'. Preambul adalah bagian pembuka dari Konstitusi, sama seperti Prolog adalah bagian pembuka dari sebuah Drama."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "KORUPSI : PEMERINTAHAN",
    "options": ["Penyakit : Tubuh", "Plagiarisme : Akademisi", "Pembajakan : Perusahaan", "Doping : Atlet", "Kriminalitas : Polisi"],
    "answer": "Penyakit : Tubuh",
    "explanation": "Hubungannya adalah 'sesuatu yang merusak/menggerogoti : sistem yang dirusak'. Korupsi merusak sistem Pemerintahan, sama seperti Penyakit merusak sistem Tubuh."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "KOREOGRAFER : TARI",
    "options": ["Sutradara : Film", "Komposer : Lagu", "Konduktor : Orkestra", "Pematung : Patung", "Pelukis : Galeri"],
    "answer": "Konduktor : Orkestra",
    "explanation": "Hubungannya adalah 'pemimpin/pengatur : pertunjukan/kelompok yang dipimpin'. Koreografer mengatur sebuah pertunjukan Tari, sama seperti Konduktor memimpin sebuah kelompok Orkestra."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "GERHANA : VISIBILITAS",
    "options": ["Banjir : Surut", "Resesi : Ekonomi", "Kemarau : Kekeringan", "Kabut : Jarak Pandang", "Badai : Kecepatan"],
    "answer": "Kabut : Jarak Pandang",
    "explanation": "Hubungannya adalah 'fenomena alam : aspek yang terpengaruh/berkurang'. Gerhana menyebabkan berkurangnya Visibilitas (kemampuan melihat), sama seperti Kabut menyebabkan berkurangnya Jarak Pandang."
  },
  {
    "subtest": "Tes Kemampuan Verbal (Analogi)",
    "question": "DESIBEL : SUARA",
    "options": ["Kalori : Makanan", "Volt : Listrik", "Lumen : Cahaya", "Are : Jarak", "Ohm : Hambatan"],
    "answer": "Lumen : Cahaya",
    "explanation": "Hubungannya adalah 'satuan intensitas : fenomena yang diukur'. Desibel adalah satuan untuk mengukur intensitas Suara, sama seperti Lumen adalah satuan untuk mengukur intensitas Cahaya."
  }
],

    // --- Data dinamis ini tidak perlu diubah ---
    judulHalaman: document.title,
    url: window.location.href
};

// ===================================================================================
// --- FUNGSI PENGIRIMAN DATA KE GOOGLE SHEET (DIPERBARUI) ---
// ===================================================================================
async function kirimKeGoogleSheet(data) {
    const statusEl = document.getElementById('submission-status');
    statusEl.textContent = 'Mengirim hasil ujian...';
    
    const formData = new FormData();
    // Menambahkan semua data ke dalam objek FormData.
    formData.append('kategori', data.kategori);
    formData.append('url', data.url);
    formData.append('judulHalaman', data.judulHalaman);
    formData.append('Nama', data.Nama);
    formData.append('JumlahSoal', data.JumlahSoal);
    formData.append('JawabanBenar', data.JawabanBenar);
    formData.append('JawabanSalah', data.JawabanSalah);
    formData.append('TidakDijawab', data.TidakDijawab);
    formData.append('Durasi', data.Durasi);
    formData.append('Nilai', data.Nilai);
    formData.append('StatusKelulusan', data.StatusKelulusan);

    try {
        const response = await fetch(EXAM_CONFIG.scriptURL, {
            method: 'POST',
            body: formData
        });
        
        // Membaca respons sebagai JSON untuk mendapatkan pesan sukses/error dari server
        const result = await response.json();
        
        if (result.result === "success") {
            statusEl.innerHTML = `Hasil ujian berhasil disimpan. <b><a href="${EXAM_CONFIG.linkPeringkat}">Cek Peringkat kamu di sini</a></b>`;
            statusEl.style.color = 'green';
        } else {
            // Menampilkan pesan error yang lebih spesifik dari server
            throw new Error(result.message || 'Terjadi kesalahan dari server.');
        }
    } catch (error) {
        console.error('Error saat mengirim ke Google Sheet:', error);
        statusEl.textContent = `Gagal menyimpan hasil. Coba lagi nanti. Error: ${error.message}`;
        statusEl.style.color = 'red';
    }
}

// ===================================================================================
// --- LOGIKA UTAMA UJIAN (DISESUAIKAN, TIDAK PERLU DIUBAH LAGI) ---
// ===================================================================================
document.addEventListener('DOMContentLoaded', () => {
    // Menggunakan bank soal dari EXAM_CONFIG
    const questions = EXAM_CONFIG.bankSoal;
    let currentQuestionIndex = 0;
    let userAnswers = new Array(questions.length).fill(null);
    let questionStatus = new Array(questions.length).fill('unanswered');
    let timerInterval;
    let startTime;
    let currentUsername = '';

    const loginContainer = document.getElementById('login-container');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const loginBtn = document.getElementById('login-btn');
    const loginError = document.getElementById('login-error');
    const appHeader = document.querySelector('.header');
    const quizContainer = document.querySelector('.quiz-container');
    const resultPage = document.getElementById('result-page');
    const subtestTitleEl = document.getElementById('subtest-title');
    const questionNumberEl = document.getElementById('question-number');
    const questionTextEl = document.getElementById('question-text');
    const optionsEl = document.getElementById('options');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const doubtfulBtn = document.getElementById('doubtful-btn');
    const finishBtn = document.getElementById('finish-btn');
    const timerEl = document.getElementById('timer');
    const restartBtn = document.getElementById('restart-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const headerInfo = document.getElementById('header-info');
    const confirmationModal = document.getElementById('confirmation-modal');
    const confirmYesBtn = document.getElementById('confirm-yes');
    const confirmNoBtn = document.getElementById('confirm-no');
    
    function showLoginPage() {
        loginContainer.style.display = 'block'; // Diubah dari 'flex' agar sesuai skrip asli
        appHeader.style.display = 'none';
        quizContainer.style.display = 'none';
        resultPage.style.display = 'none';
        passwordInput.value = '';
        loginError.style.display = 'none';
    }

    function handleLogin() {
        const password = passwordInput.value;
        const username = usernameInput.value.trim();
        if (username === "") {
            loginError.textContent = "Username tidak boleh kosong.";
            loginError.style.display = 'block';
            return;
        }
        // Menggunakan password dari EXAM_CONFIG
        if (password === EXAM_CONFIG.password) {
            currentUsername = username;
            loginContainer.style.display = 'none';
            appHeader.style.display = 'flex';
            quizContainer.style.display = 'flex';
            resultPage.style.display = 'none';
            headerInfo.textContent = `Peserta: ${currentUsername}`;
            startQuiz();
        } else {
            loginError.textContent = "Password salah. Coba lagi.";
            loginError.style.display = 'block';
        }
    }
    
    function handleLogout() {
        clearInterval(timerInterval);
        showLoginPage();
    }

    function startQuiz() {
        currentQuestionIndex = 0;
        userAnswers.fill(null);
        questionStatus.fill('unanswered');
        quizContainer.style.display = 'flex';
        resultPage.style.display = 'none';
        setupQuestionGrids();
        displayQuestion(currentQuestionIndex);
        // Menggunakan durasi dari EXAM_CONFIG
        startTimer(EXAM_CONFIG.durasiMenit * 60);
        startTime = new Date();
    }

    function setupQuestionGrids() {
        const gridContainer = document.getElementById('grid-container');
        gridContainer.innerHTML = '';
        const subtests = [...new Set(questions.map(q => q.subtest))];
        subtests.forEach(subtest => {
            const group = document.createElement('div');
            group.className = 'subtest-group';
            const title = document.createElement('h3');
            title.textContent = subtest;
            const grid = document.createElement('div');
            grid.className = 'question-grid';
            group.appendChild(title);
            group.appendChild(grid);
            gridContainer.appendChild(group);
            questions.forEach((q, index) => {
                if (q.subtest === subtest) {
                    const button = document.createElement('button');
                    button.className = 'grid-button';
                    button.textContent = index + 1;
                    button.onclick = () => jumpToQuestion(index);
                    grid.appendChild(button);
                }
            });
        });
    }

    function displayQuestion(index) {
        document.querySelector('.grid-button.current')?.classList.remove('current');
        currentQuestionIndex = index;
        const question = questions[index];
        subtestTitleEl.textContent = question.subtest;
        questionNumberEl.textContent = index + 1;
        questionTextEl.innerHTML = question.question;
        optionsEl.innerHTML = '';
        question.options.forEach(option => {
            const li = document.createElement('li');
            const label = document.createElement('label');
            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = `option-${index}`;
            radio.value = option;
            if (userAnswers[index] === option) {
                radio.checked = true;
                label.classList.add('selected');
            }
            radio.onchange = () => selectAnswer(index, option, label);
            const span = document.createElement('span');
            span.innerHTML = option; // Menggunakan innerHTML untuk render jika ada format
            label.appendChild(radio);
            label.appendChild(span);
            li.appendChild(label);
            optionsEl.appendChild(li);
        });
        updateNavButtons();
        updateGridButtonStatus(index, true);
    }

    function selectAnswer(index, answer, label) {
        userAnswers[index] = answer;
        document.querySelectorAll(`#options li label`).forEach(l => l.classList.remove('selected'));
        label.classList.add('selected');
        if (questionStatus[index] !== 'doubtful') {
            questionStatus[index] = 'answered';
        }
        updateGridButtonStatus(index);
    }
    
    function updateNavButtons() {
        prevBtn.disabled = currentQuestionIndex === 0;
        nextBtn.disabled = currentQuestionIndex === questions.length - 1;
    }
    
    function updateGridButtonStatus(index, isCurrent = false) {
        const allGridButtons = document.querySelectorAll('.grid-button');
        if (isCurrent) {
            const currentBtn = document.querySelector('.grid-button.current');
            if (currentBtn) currentBtn.classList.remove('current');
        }
        const button = Array.from(allGridButtons).find(btn => parseInt(btn.textContent) === index + 1);
        if (!button) return;
        if(isCurrent) button.classList.add('current');
        button.classList.remove('answered', 'doubtful');
        switch (questionStatus[index]) {
            case 'answered': button.classList.add('answered'); break;
            case 'doubtful': button.classList.add('doubtful'); break;
        }
    }

    function jumpToQuestion(index) {
        displayQuestion(index);
    }

    function startTimer(duration) {
        let timer = duration;
        clearInterval(timerInterval);
        timerEl.parentElement.classList.remove('low-time');
        timerInterval = setInterval(() => {
            let minutes = parseInt(timer / 60, 10);
            let seconds = parseInt(timer % 60, 10);
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;
            timerEl.textContent = `${minutes}:${seconds}`;
            if (timer < 300 && !timerEl.parentElement.classList.contains('low-time')) { 
                timerEl.parentElement.classList.add('low-time'); 
            }
            if (--timer < 0) {
                clearInterval(timerInterval);
                finishQuiz();
            }
        }, 1000);
    }
    
    function showConfirmation() {
        confirmationModal.style.display = 'flex';
    }

    function formatDuration(ms) {
    const totalSeconds = Math.floor(ms / 1000);
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    return `${minutes} menit ${seconds.toString().padStart(2, '0')} detik`;
}


    function finishQuiz() {
        clearInterval(timerInterval);
        confirmationModal.style.display = 'none';
        const endTime = new Date();
        const durationMs = endTime - startTime;
        let correctCount = 0;
        questions.forEach((q, index) => {
            if (userAnswers[index] === q.answer) correctCount++;
        });
        const totalQuestions = questions.length;
        const answeredCount = userAnswers.filter(a => a !== null).length;
        const incorrectCount = answeredCount - correctCount;
        const unansweredCount = totalQuestions - answeredCount;
        const finalScore = totalQuestions > 0 ? parseFloat(((correctCount / totalQuestions) * 100).toFixed(2)) : 0;
        const isPassed = finalScore >= EXAM_CONFIG.passingGrade;
        
        quizContainer.style.display = 'none';
        resultPage.style.display = 'block';
        headerInfo.textContent = `Hasil Ujian: ${currentUsername}`;
        
        const statusEl = document.getElementById('status-lulus');
        statusEl.textContent = isPassed ? 'SELAMAT, ANDA LULUS!' : 'MAAF, ANDA BELUM LULUS';
        statusEl.className = `status ${isPassed ? 'lulus' : 'gagal'}`;
        document.getElementById('final-score').textContent = finalScore;
        document.getElementById('score-details').textContent = `${correctCount} dari ${totalQuestions} soal benar`;
        
        const reviewSection = document.getElementById('review-section');
        reviewSection.innerHTML = '';
        questions.forEach((q, index) => {
            const userAnswer = userAnswers[index];
            const isCorrect = userAnswer === q.answer;
            reviewSection.innerHTML += `
                <div class="review-item">
                    <p><strong>Soal ${index + 1}:</strong> ${q.question}</p>
                    <div class="review-answer user-answer ${isCorrect ? '' : 'is-incorrect'}">Jawaban Anda: ${userAnswer || 'Tidak Dijawab'}</div>
                    ${!isCorrect ? `<div class="review-answer correct-answer">Jawaban Benar: ${q.answer}</div>` : ''}
                    <div class="explanation"><strong>Pembahasan:</strong> ${q.explanation}</div>
                </div>
            `;
        });
        
        const dataForSheet = {
            kategori: EXAM_CONFIG.kategori,
            url: EXAM_CONFIG.url,
            judulHalaman: EXAM_CONFIG.judulHalaman,
            Nama: currentUsername,
            JumlahSoal: totalQuestions,
            JawabanBenar: correctCount,
            JawabanSalah: incorrectCount,
            TidakDijawab: unansweredCount,
            Durasi: formatDuration(durationMs),
            Nilai: finalScore,
            StatusKelulusan: isPassed ? 'Lulus' : 'Tidak Lulus'
        };
        kirimKeGoogleSheet(dataForSheet);
    }

    // Event Listeners
    loginBtn.addEventListener('click', handleLogin);
    passwordInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') handleLogin(); });
    logoutBtn.addEventListener('click', handleLogout);
    prevBtn.addEventListener('click', () => { if (currentQuestionIndex > 0) displayQuestion(currentQuestionIndex - 1) });
    nextBtn.addEventListener('click', () => { if (currentQuestionIndex < questions.length - 1) displayQuestion(currentQuestionIndex + 1) });
    doubtfulBtn.addEventListener('click', () => {
        const currentStatus = questionStatus[currentQuestionIndex];
        if (currentStatus === 'doubtful') {
            questionStatus[currentQuestionIndex] = userAnswers[currentQuestionIndex] ? 'answered' : 'unanswered';
        } else {
            questionStatus[currentQuestionIndex] = 'doubtful';
        }
        updateGridButtonStatus(currentQuestionIndex);
    });
    finishBtn.addEventListener('click', showConfirmation);
    confirmYesBtn.addEventListener('click', finishQuiz);
    confirmNoBtn.addEventListener('click', () => confirmationModal.style.display = 'none');
    restartBtn.addEventListener('click', handleLogout);

    showLoginPage();
});
</script>
