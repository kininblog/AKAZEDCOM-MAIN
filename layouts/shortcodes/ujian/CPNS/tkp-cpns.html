    <style>
        :root {
            --primary-bg: #f0f2f5;
            --panel-bg: #ffffff;
            --header-bg: #0d47a1; /* Biru Tua */
            --header-text: #ffffff;
            --text-color: #333333;
            --border-color: #dee2e6;
            --primary-action-bg: #1976d2; /* Biru */
            --primary-action-hover: #1565c0;
            --answered-bg: #4caf50; /* Hijau */
            --correct-bg: #e8f5e9;
            --correct-text: #2e7d32;
            --incorrect-bg: #ffebee;
            --incorrect-text: #c62828;
            --doubtful-bg: #ffc107; /* Kuning */
            --current-bg: #ff9800; /* Oranye */
            --unanswered-bg: #ffffff;
            --timer-alert: #d32f2f; /* Merah */
        }


        /* --- Halaman Login --- */
        #login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-grow: 1;
            padding: 20px;
        }
        .login-box {
            background-color: var(--panel-bg);
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        .login-box h2 {
            margin-top: 0;
            margin-bottom: 25px;
            color: var(--header-bg);
        }
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box;
        }
        #login-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-action-bg);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #login-btn:hover {
            background-color: var(--primary-action-hover);
        }
        #login-error {
            color: var(--timer-alert);
            margin-top: 15px;
            font-weight: 500;
            display: none;
        }

        /* Header */
        .header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header h2 {
            font-size: 1.2em;
            margin: 0;
        }
        .user-info {
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        #logout-btn {
            background: none;
            border: 1px solid var(--header-text);
            color: var(--header-text);
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #logout-btn:hover {
            background-color: rgba(255,255,255,0.1);
        }


        /* Main Container */
        .quiz-container {
            display: flex;
            flex: 1;
            padding: 15px;
            gap: 15px;
            overflow: hidden;
            height: calc(100vh - 58px); /* Adjusted for header height */
        }

        /* Question Panel (Left) */
        .question-panel {
            flex: 3;
            background-color: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .question-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            background-color: #f8f9fa;
        }
        .question-header #subtest-title {
            font-weight: 700;
            color: var(--header-bg);
        }
        .question-body {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
            line-height: 1.6;
        }
        .question-text {
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        .options-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .options-list li {
            margin-bottom: 10px;
        }
        .options-list label {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .options-list label:hover {
            background-color: #e3f2fd;
        }
        .options-list input[type="radio"] {
            margin-right: 15px;
            margin-top: 5px;
        }
        .options-list input[type="radio"]:checked + span {
            font-weight: 700;
        }
        .options-list label.selected {
            background-color: #bbdefb;
            border-color: var(--primary-action-bg);
        }

        /* Navigation Panel (Right) */
        .navigation-panel {
            flex: 1.2;
            background-color: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            min-width: 300px;
        }
        .timer-box {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }
        #timer {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--header-bg);
            letter-spacing: 2px;
        }
        #timer.low-time {
            color: var(--timer-alert);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .question-grid-container {
            padding: 15px;
            flex: 1;
            overflow-y: auto;
        }
        .subtest-group {
            margin-bottom: 15px;
        }
        .subtest-group h3 {
            font-size: 0.9em;
            margin: 0 0 10px 0;
            color: var(--text-color);
            border-bottom: 2px solid var(--primary-action-bg);
            padding-bottom: 5px;
        }
        .question-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 8px;
        }
        .grid-button {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border-color);
            background-color: var(--unanswered-bg);
            cursor: pointer;
            border-radius: 5px;
            font-weight: 500;
            transition: all 0.2s;
        }
        .grid-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .grid-button.answered { background-color: var(--answered-bg); color: white; border-color: var(--answered-bg); }
        .grid-button.doubtful { background-color: var(--doubtful-bg); border-color: var(--doubtful-bg); }
        .grid-button.current { border: 2px solid var(--current-bg); }

        /* Footer / Actions */
        .quiz-actions {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8f9fa;
        }
        .action-button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 700;
            transition: background-color 0.2s;
        }
        #prev-btn, #next-btn {
            background-color: var(--primary-action-bg);
            color: white;
        }
        #prev-btn:disabled, #next-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #doubtful-btn {
            background-color: var(--doubtful-bg);
            color: #333;
        }
        #finish-btn {
            background-color: var(--timer-alert);
            color: white;
        }

        /* Confirmation Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            animation: slide-down 0.3s ease-out;
        }
        @keyframes slide-down {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-content h2 {
            margin-top: 0;
            color: var(--header-bg);
        }
        .modal-actions {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        #confirm-yes {
            background-color: var(--primary-action-bg);
            color: white;
        }
        #confirm-no {
            background-color: #6c757d;
            color: white;
        }
        
        /* --- Result Page Styles --- */
        .result-container {
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        .result-container h2, .result-container h3 {
            color: var(--header-bg);
        }
        .result-card {
            background-color: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .overall-summary {
            text-align: center;
        }
        .overall-summary .score {
            font-size: 3em;
            font-weight: 700;
            color: var(--answered-bg);
        }
        .overall-summary .score-details {
            font-size: 1.1em;
            color: var(--text-color);
        }
        .subtest-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .subtest-card {
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            text-align: center;
        }
        .subtest-card h4 {
            margin: 0 0 10px 0;
        }
        .subtest-card .subtest-score {
            font-size: 1.5em;
            font-weight: 500;
        }

        .answer-list {
            padding: 0;
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .answer-list li {
            width: 35px;
            height: 35px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            font-weight: 500;
        }
        .answer-list li.correct {
            background-color: var(--correct-text);
            color: white;
        }
        .answer-list li.incorrect {
            background-color: var(--incorrect-text);
            color: white;
        }
        
        .review-item {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        .review-item .review-q-text {
            font-weight: 500;
        }
        .review-item .review-answer {
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
        }
        .review-item .user-answer {
            background-color: var(--incorrect-bg);
            border-left: 4px solid var(--incorrect-text);
            color: var(--incorrect-text);
        }
        .review-item .correct-answer {
            background-color: var(--correct-bg);
            border-left: 4px solid var(--correct-text);
            color: var(--correct-text);
        }
        .review-item .explanation {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-style: italic;
        }
        #restart-btn {
            margin-top: 20px;
            padding: 12px 25px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: var(--primary-action-bg);
            color: white;
        }
        
        /* Hidden by default */
        .header, .quiz-container, #result-page {
            display: none;
        }
        
        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            .quiz-container {
                flex-direction: column;
                height: auto;
                overflow: visible;
            }
            .navigation-panel {
                min-width: unset;
                flex: unset; /* Unset flex grow/shrink */
                height: auto;
            }
            .question-panel {
                min-height: 40vh;
            }
            .header h2 {
                font-size: 1em;
            }
        }
        
        @media (max-width: 480px) {
            .login-box {
                padding: 20px;
            }
            .question-body, .quiz-actions {
                padding: 15px;
            }
            .action-button {
                padding: 8px 12px;
                font-size: 0.9em;
            }
        }

    </style>
    
    <div id="login-container">
        <div class="login-box">
            <h2>Login Peserta Ujian</h2>
            <div class="input-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Masukkan username Anda">
            </div>
            <div class="input-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Masukkan password">
            </div>
            <button id="login-btn">Masuk</button>
            <p id="login-error">Password salah. Coba lagi.</p>
        </div>
    </div>

    <header class="header">
        <h2>Ujian Tes Karakteristik Pribadi (TKP) CPNS</h2>
        <div class="user-info">
            <span id="header-info"></span>
            <button id="logout-btn">Logout</button>
        </div>
    </header>

    <div class="quiz-container">
        <!-- Panel Soal -->
        <main class="question-panel">
            <div class="question-header">
                <span id="subtest-title">Tes Karakteristik Pribadi</span> | Soal No. <span id="question-number">1</span>
            </div>
            <div class="question-body">
                <p id="question-text">Memuat soal...</p>
                <ul id="options" class="options-list"></ul>
            </div>
            <div class="quiz-actions">
                <button id="prev-btn" class="action-button">Sebelumnya</button>
                <button id="doubtful-btn" class="action-button">Ragu-ragu</button>
                <button id="next-btn" class="action-button">Selanjutnya</button>
            </div>
        </main>

        <!-- Panel Navigasi -->
        <aside class="navigation-panel">
            <div class="timer-box">
                Sisa Waktu
                <div id="timer">40:00</div>
            </div>
            <div class="question-grid-container">
                <div class="subtest-group">
                    <h3>Tes Karakteristik Pribadi (1-35)</h3>
                    <div id="grid-tkp" class="question-grid"></div>
                </div>
            </div>
            <div class="quiz-actions" style="justify-content: center;">
                <button id="finish-btn" class="action-button">Selesaikan Ujian</button>
            </div>
        </aside>
    </div>

    <!-- Halaman Hasil Ujian -->
    <div id="result-page" class="result-container">
        <div class="result-card overall-summary">
            <h2>Hasil Akhir Ujian TKP</h2>
            <div id="final-score" class="score">0%</div>
            <div id="score-details" class="score-details"></div>
            <div id="subtest-analysis-container" class="subtest-analysis"></div>
        </div>
        
        <div class="result-card">
            <h3>Rekap Jawaban</h3>
            <h4>Jawaban Pilihan Anda (Skor Tertinggi)</h4>
            <ul id="correct-list" class="answer-list"></ul>
            <h4 style="margin-top: 20px;">Jawaban Kurang Tepat / Kosong</h4>
            <ul id="incorrect-list" class="answer-list"></ul>
        </div>
        
        <div id="review-section-container" class="result-card">
            <h3>Pembahasan Jawaban</h3>
            <div id="review-section"></div>
        </div>
        
        <div style="text-align: center;">
           <button id="restart-btn" class="action-button">Ulangi Ujian</button>
        </div>
    </div>
    
    <!-- Modal Konfirmasi Selesai -->
    <div id="confirmation-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Selesaikan Ujian?</h2>
            <p>Apakah Anda yakin ingin menyelesaikan dan mengakhiri sesi ujian ini?</p>
            <div class="modal-actions">
                <button id="confirm-no" class="action-button">Batal</button>
                <button id="confirm-yes" class="action-button">Ya, Selesaikan</button>
            </div>
        </div>
    </div>


<script>
// --- DATABASE SOAL TKP (DIPERBARUI) ---
const questions = [
    // --- TES KARAKTERISTIK PRIBADI (TKP) - 35 Soal ---
    // Soal Aspek: Pelayanan Publik
    { subtest: 'Tes Karakteristik Pribadi', question: 'Seorang warga datang ke kantor Anda untuk mengurus perizinan, namun ia tidak membawa dokumen yang lengkap. Sikap Anda adalah:', options: ['Langsung menolaknya dan memintanya kembali setelah lengkap.', 'Memberikan formulir dan daftar persyaratan, lalu menjelaskan dengan sabar apa saja yang perlu dilengkapi.', 'Menyuruhnya bertanya pada petugas lain karena itu bukan tugas utama saya.', 'Mengomelinya karena tidak membaca pengumuman persyaratan.', 'Membantunya mengurus meskipun dokumen tidak lengkap dengan syarat tertentu.'], answer: 'Memberikan formulir dan daftar persyaratan, lalu menjelaskan dengan sabar apa saja yang perlu dilengkapi.', explanation: 'Jawaban ini menunjukkan orientasi pelayanan yang prima. Anda tidak hanya menegakkan aturan, tetapi juga memberikan solusi dan informasi yang jelas dengan sikap yang baik dan sabar.' },
    // Soal Aspek: Jejaring Kerja
    { subtest: 'Tes Karakteristik Pribadi', question: 'Anda ditugaskan dalam sebuah tim kerja yang anggotanya memiliki latar belakang yang sangat beragam. Terjadi perdebatan sengit karena perbedaan pendapat. Sebagai anggota tim, Anda akan:', options: ['Mendiamkan saja hingga perdebatan selesai.', 'Memihak pada pendapat yang saya anggap paling benar.', 'Mencoba menjadi penengah, mencari titik temu dari semua pendapat, dan mengingatkan kembali tujuan bersama tim.', 'Melaporkan pada atasan bahwa tim tidak kondusif.', 'Mengajak anggota yang sependapat dengan saya untuk membuat kelompok kecil.'], answer: 'Mencoba menjadi penengah, mencari titik temu dari semua pendapat, dan mengingatkan kembali tujuan bersama tim.', explanation: 'Sikap ini menunjukkan kemampuan mengelola sosial-emosional, bekerja sama, dan berorientasi pada tujuan. Menjadi penengah adalah kunci untuk menjaga soliditas tim.' },
    // Soal Aspek: Profesionalisme
    { subtest: 'Tes Karakteristik Pribadi', question: 'Anda menemukan rekan kerja Anda menggunakan fasilitas kantor untuk kepentingan pribadi yang tidak semestinya. Sikap Anda:', options: ['Membiarkannya, karena itu bukan urusan saya.', 'Menegurnya secara langsung di depan rekan kerja lain agar jera.', 'Melaporkannya langsung kepada atasan tanpa berbicara dengannya terlebih dahulu.', 'Mengingatkannya secara baik-baik dan pribadi bahwa hal tersebut tidak sesuai dengan aturan.', 'Ikut menggunakan fasilitas tersebut selagi tidak ada yang tahu.'], answer: 'Mengingatkannya secara baik-baik dan pribadi bahwa hal tersebut tidak sesuai dengan aturan.', explanation: 'Pilihan ini menunjukkan integritas dan kepedulian. Anda menegakkan aturan dengan cara yang etis dan tidak mempermalukan rekan kerja, menjaga hubungan baik namun tetap profesional.' },
    // Soal Aspek: Teknologi Informasi dan Komunikasi
    { subtest: 'Tes Karakteristik Pribadi', question: 'Instansi Anda baru saja menerapkan sistem aplikasi baru untuk pelaporan kinerja yang cukup rumit. Anda belum terlalu memahaminya. Tindakan Anda:', options: ['Meminta orang lain untuk mengerjakan laporan saya.', 'Menghindar dari tugas yang memerlukan penggunaan aplikasi tersebut.', 'Berusaha mempelajarinya sendiri melalui buku panduan dan bertanya pada rekan yang lebih paham.', 'Mengeluh kepada manajemen tentang sulitnya aplikasi tersebut.', 'Mengerjakan laporan secara manual seperti biasa.'], answer: 'Berusaha mempelajarinya sendiri melalui buku panduan dan bertanya pada rekan yang lebih paham.', explanation: 'Jawaban ini menunjukkan kemauan belajar dan kemampuan beradaptasi dengan teknologi. Sikap proaktif untuk menguasai hal baru adalah ciri ASN yang profesional.' },
    // Soal Aspek: Anti Radikalisme
    { subtest: 'Tes Karakteristik Pribadi', question: 'Di media sosial, Anda melihat seorang teman menyebarkan berita yang provokatif dan berpotensi memecah belah persatuan. Reaksi Anda adalah:', options: ['Ikut menyebarkannya karena sedang viral.', 'Langsung berkomentar dengan kata-kata kasar di postingannya.', 'Tidak peduli dan mengabaikannya.', 'Tidak ikut berkomentar di ranah publik, namun mengirim pesan pribadi untuk mengingatkannya agar lebih bijak dan tidak menyebar berita bohong.', 'Memblokir teman tersebut.'], answer: 'Tidak ikut berkomentar di ranah publik, namun mengirim pesan pribadi untuk mengingatkannya agar lebih bijak dan tidak menyebar berita bohong.', explanation: 'Tindakan ini mencerminkan kedewasaan emosional dan kepedulian sosial. Anda tidak memperkeruh suasana, tetapi berusaha mencegah penyebaran hoaks dengan cara yang bijaksana dan personal.' },
    // Soal Aspek: Semangat Berprestasi
    { subtest: 'Tes Karakteristik Pribadi', question: 'Atasan memberikan Anda pekerjaan yang menantang dan di luar zona nyaman Anda. Sikap Anda:', options: ['Langsung menolak karena merasa tidak sanggup.', 'Menerimanya dengan setengah hati dan banyak mengeluh.', 'Menerimanya sebagai kesempatan untuk belajar dan mengembangkan kemampuan diri.', 'Meminta atasan untuk memberikan pekerjaan tersebut kepada rekan lain yang lebih berpengalaman.', 'Mencari alasan agar tidak mengerjakan tugas tersebut.'], answer: 'Menerimanya sebagai kesempatan untuk belajar dan mengembangkan kemampuan diri.', explanation: 'Ini menunjukkan semangat untuk terus belajar dan berprestasi. Melihat tantangan sebagai peluang adalah kunci untuk pengembangan karier dan pribadi.' },
    // Soal Aspek: Pelayanan Publik
    { subtest: 'Tes Karakteristik Pribadi', question: 'Saat Anda sedang sibuk, seorang ibu tua tampak kebingungan di ruang pelayanan. Yang Anda lakukan:', options: ['Berpura-pura tidak melihat karena pekerjaan saya menumpuk.', 'Menyuruh satpam untuk membantunya.', 'Meluangkan waktu sejenak untuk menyapa dan menanyakan apa yang bisa dibantu, lalu mengarahkannya ke petugas yang tepat.', 'Membiarkannya, nanti juga akan ada yang membantu.', 'Menyindirnya mengapa tidak bertanya dari tadi.'], answer: 'Meluangkan waktu sejenak untuk menyapa dan menanyakan apa yang bisa dibantu, lalu mengarahkannya ke petugas yang tepat.', explanation: 'Sikap ini menunjukkan empati dan kepedulian yang tinggi (orientasi pelayanan). Meskipun sibuk, Anda tetap menunjukkan inisiatif untuk membantu masyarakat.' },
    // Soal Aspek: Profesionalisme
    { subtest: 'Tes Karakteristik Pribadi', question: 'Anda melakukan kesalahan dalam pekerjaan yang menyebabkan kerugian kecil bagi instansi. Tindakan Anda:', options: ['Menyembunyikan kesalahan tersebut agar tidak diketahui atasan.', 'Melemparkan kesalahan tersebut kepada rekan kerja lain.', 'Segera melapor kepada atasan, mengakui kesalahan, dan siap menerima konsekuensinya serta menawarkan solusi perbaikan.', 'Berharap tidak ada yang menyadari kesalahan tersebut.', 'Memperbaikinya diam-diam tanpa melapor kepada siapa pun.'], answer: 'Segera melapor kepada atasan, mengakui kesalahan, dan siap menerima konsekuensinya serta menawarkan solusi perbaikan.', explanation: 'Ini adalah cerminan integritas dan tanggung jawab yang tinggi. Mengakui kesalahan dan proaktif mencari solusi menunjukkan sikap profesional sejati.' },
    // Soal Aspek: Jejaring Kerja
    { subtest: 'Tes Karakteristik Pribadi', question: 'Divisi lain meminta bantuan data dari divisi Anda, namun prosesnya cukup merepotkan. Sikap Anda:', options: ['Menolak dengan alasan sibuk dengan pekerjaan divisi sendiri.', 'Membantu dengan terpaksa dan menggerutu.', 'Memberikan data yang diminta seadanya saja.', 'Menjelaskan prosedur permintaan data yang benar dan membantu memfasilitasinya demi kelancaran kerja instansi secara keseluruhan.', 'Meminta imbalan karena telah membantu.'], answer: 'Menjelaskan prosedur permintaan data yang benar dan membantu memfasilitasinya demi kelancaran kerja instansi secara keseluruhan.', explanation: 'Jawaban ini menunjukkan kemampuan bekerja sama lintas divisi dan memahami bahwa kesuksesan instansi adalah kerja kolektif. Anda tetap menjaga profesionalisme (prosedur) sambil bersikap kolaboratif.' },
    // Soal Aspek: Sosial Budaya
    { subtest: 'Tes Karakteristik Pribadi', question: 'Anda ditempatkan di daerah baru yang adat dan budayanya sangat berbeda dengan Anda. Sikap Anda:', options: ['Merasa tidak nyaman dan ingin segera pindah.', 'Menjaga jarak dengan masyarakat setempat agar tidak terjadi konflik.', 'Berusaha mempelajari, memahami, dan menghargai adat istiadat setempat tanpa meninggalkan identitas diri.', 'Menganggap budaya saya lebih baik dari budaya setempat.', 'Hanya bergaul dengan rekan kerja yang berasal dari daerah yang sama.'], answer: 'Berusaha mempelajari, memahami, dan menghargai adat istiadat setempat tanpa meninggalkan identitas diri.', explanation: 'Ini menunjukkan kemampuan beradaptasi sosial budaya yang tinggi. Mampu menghargai perbedaan dan berinteraksi secara positif adalah kompetensi penting bagi seorang ASN.' },
    // Lanjutan Soal Unik...
    { subtest: 'Tes Karakteristik Pribadi', question: 'Ketika menghadapi kegagalan dalam suatu proyek, saya akan...', options: ['Menyalahkan keadaan dan faktor eksternal.', 'Mencari siapa yang paling bertanggung jawab atas kegagalan ini.', 'Merasa sangat kecewa dan kehilangan motivasi.', 'Mengevaluasi secara menyeluruh apa yang salah, belajar dari kesalahan, dan menyusun strategi baru.', 'Segera melupakan kegagalan tersebut dan beralih ke tugas lain.'], answer: 'Mengevaluasi secara menyeluruh apa yang salah, belajar dari kesalahan, dan menyusun strategi baru.', explanation: 'Sikap ini menunjukkan orientasi pada perbaikan, ketahanan (resilience), dan kemauan untuk belajar dari pengalaman, yang merupakan kunci dari semangat berprestasi.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Prioritas utama saya sebagai seorang Aparatur Sipil Negara (ASN) adalah...', options: ['Mendapatkan jenjang karier yang tinggi.', 'Kepentingan pribadi dan keluarga.', 'Melayani masyarakat dengan tulus dan profesional.', 'Menjaga hubungan baik dengan atasan.', 'Menyelesaikan pekerjaan tepat waktu.'], answer: 'Melayani masyarakat dengan tulus dan profesional.', explanation: 'Ini adalah esensi dari menjadi ASN. Orientasi pada pelayanan publik harus menjadi prioritas tertinggi, melampaui kepentingan pribadi atau kelompok.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Jika ada rekan kerja yang meminta saya mengajarinya suatu aplikasi yang saya kuasai, saya akan...', options: ['Menolaknya dengan alasan sibuk.', 'Mengajarinya jika ada imbalan.', 'Dengan senang hati meluangkan waktu untuk mengajarinya hingga ia paham.', 'Menyarankannya untuk belajar sendiri dari internet.', 'Memberinya buku panduan dan menyuruhnya membaca.'], answer: 'Dengan senang hati meluangkan waktu untuk mengajarinya hingga ia paham.', explanation: 'Ini menunjukkan kemampuan bekerja sama dan kepedulian terhadap pengembangan tim. Berbagi ilmu adalah bagian dari membangun jejaring kerja yang positif.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Saya melihat ada ketidakadilan dalam pembagian bonus di kantor. Sikap saya:', options: ['Protes keras kepada atasan di depan semua orang.', 'Menerima saja karena tidak mau cari masalah.', 'Membicarakan hal ini di belakang atasan.', 'Mencari waktu yang tepat untuk mendiskusikan masalah ini secara konstruktif dengan atasan, berdasarkan data yang ada.', 'Mengajak rekan-rekan lain untuk melakukan demonstrasi.'], answer: 'Mencari waktu yang tepat untuk mendiskusikan masalah ini secara konstruktif dengan atasan, berdasarkan data yang ada.', explanation: 'Sikap ini menunjukkan kematangan emosional dan profesionalisme. Anda memperjuangkan keadilan dengan cara yang etis dan berdasarkan fakta, bukan emosi.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Tugas yang saya sukai adalah tugas yang...', options: ['Mudah dan tidak banyak berpikir.', 'Rutin dan sudah saya kuasai.', 'Memberikan saya kesempatan untuk menunjukkan kemampuan terbaik dan mempelajari hal-hal baru.', 'Populer dan mendapat banyak pujian.', 'Bisa dikerjakan secara santai.'], answer: 'Memberikan saya kesempatan untuk menunjukkan kemampuan terbaik dan mempelajari hal-hal baru.', explanation: 'Jawaban ini mencerminkan motivasi berprestasi yang tinggi dan keinginan untuk terus berkembang (continuous improvement).' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Saat rapat, pendapat saya ditolak oleh mayoritas peserta rapat. Reaksi saya:', options: ['Merasa kecewa dan tidak mau lagi berpendapat.', 'Menerima penolakan tersebut dengan lapang dada dan tetap berkontribusi dalam rapat.', 'Mempertahankan pendapat saya dengan segala cara.', 'Diam dan tidak mengikuti sisa rapat dengan baik.', 'Menyalahkan peserta lain yang tidak memahami ide saya.'], answer: 'Menerima penolakan tersebut dengan lapang dada dan tetap berkontribusi dalam rapat.', explanation: 'Ini menunjukkan kedewasaan dan kemampuan mengendalikan diri. Dalam kerja tim, keputusan bersama lebih utama daripada ego pribadi.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Seorang teman mengajak saya untuk berbisnis menggunakan jam kerja. Saya akan:', options: ['Langsung setuju karena peluangnya bagus.', 'Menolaknya dengan tegas karena itu melanggar aturan dan integritas sebagai ASN.', 'Memikirkannya terlebih dahulu.', 'Melaporkannya kepada atasan.', 'Setuju asalkan dilakukan secara diam-diam.'], answer: 'Menolaknya dengan tegas karena itu melanggar aturan dan integritas sebagai ASN.', explanation: 'Integritas adalah hal yang mutlak bagi seorang ASN. Menolak godaan yang melanggar aturan adalah cerminan profesionalisme yang tinggi.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Dalam bekerja, saya lebih suka...', options: ['Bekerja sendiri karena lebih cepat.', 'Bekerja dalam tim untuk tugas apapun.', 'Bekerja sendiri untuk tugas yang membutuhkan konsentrasi, namun berkolaborasi untuk tugas yang membutuhkan banyak ide.', 'Menunggu perintah dari atasan.', 'Bekerja sesuai dengan mood.'], answer: 'Bekerja sendiri untuk tugas yang membutuhkan konsentrasi, namun berkolaborasi untuk tugas yang membutuhkan banyak ide.', explanation: 'Jawaban ini menunjukkan fleksibilitas dan pemahaman tentang kapan harus mandiri dan kapan harus berkolaborasi. Ini adalah ciri pekerja yang efektif.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Ketika ada perubahan mendadak dalam rencana kerja, saya...', options: ['Merasa panik dan bingung.', 'Menolak perubahan tersebut karena sudah menyusun rencana awal.', 'Segera beradaptasi dan menyesuaikan kembali prioritas kerja saya dengan perubahan tersebut.', 'Menyalahkan pihak yang membuat perubahan.', 'Melanjutkan rencana awal tanpa mempedulikan perubahan.'], answer: 'Segera beradaptasi dan menyesuaikan kembali prioritas kerja saya dengan perubahan tersebut.', explanation: 'Kemampuan beradaptasi adalah kompetensi kunci di dunia kerja yang dinamis. Sikap fleksibel dan responsif terhadap perubahan sangat dihargai.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Menurut saya, orang yang jujur adalah orang yang...', options: ['Selalu mengatakan kebenaran meskipun menyakitkan.', 'Bertindak konsisten antara perkataan dan perbuatan.', 'Tidak pernah berbohong sama sekali.', 'Melaporkan setiap kesalahan orang lain.', 'Hanya memikirkan keuntungan pribadi.'], answer: 'Bertindak konsisten antara perkataan dan perbuatan.', explanation: 'Kejujuran (integritas) tidak hanya soal perkataan, tetapi juga konsistensi dalam tindakan. Ini adalah definisi yang paling komprehensif.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Saya diminta untuk menyelesaikan tugas pada hari libur karena sangat mendesak. Saya akan:', options: ['Menolak karena hari libur adalah hak saya.', 'Menerimanya dengan syarat ada uang lembur yang besar.', 'Mengerjakannya dengan tulus karena merupakan bagian dari tanggung jawab dan dedikasi pada pekerjaan.', 'Mengerjakannya sambil mengeluh di media sosial.', 'Menyuruh rekan lain untuk menggantikan saya.'], answer: 'Mengerjakannya dengan tulus karena merupakan bagian dari tanggung jawab dan dedikasi pada pekerjaan.', explanation: 'Ini menunjukkan tingkat profesionalisme dan komitmen yang tinggi. Memahami situasi darurat dan rela berkorban demi kepentingan organisasi adalah nilai lebih.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Jika saya harus memilih, saya lebih suka bekerja di lingkungan yang...', options: ['Aturannya ketat dan sangat terstruktur.', 'Santai dan tidak banyak aturan.', 'Memberikan kebebasan untuk berinovasi namun tetap memiliki target yang jelas.', 'Semua orang bekerja secara individual.', 'Penuh dengan persaingan.'], answer: 'Memberikan kebebasan untuk berinovasi namun tetap memiliki target yang jelas.', explanation: 'Pilihan ini menunjukkan keseimbangan antara kreativitas dan akuntabilitas. Ini adalah lingkungan yang ideal untuk ASN yang ingin maju dan berprestasi.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Saat menghadapi kritik dari rekan kerja, saya akan...', options: ['Langsung marah dan tersinggung.', 'Mengabaikannya sama sekali.', 'Mendengarkan kritik tersebut, merenungkannya, dan menjadikannya sebagai bahan untuk introspeksi diri.', 'Membalas mengkritik orang tersebut.', 'Menjauhi orang yang mengkritik saya.'], answer: 'Mendengarkan kritik tersebut, merenungkannya, dan menjadikannya sebagai bahan untuk introspeksi diri.', explanation: 'Sikap terbuka terhadap kritik menunjukkan kemauan untuk berkembang dan mengelola diri. Kritik adalah masukan berharga untuk perbaikan.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Teknologi baru seringkali membuat pekerjaan menjadi lebih efisien, namun saya...', options: ['Lebih suka cara lama yang sudah pasti.', 'Takut untuk mencobanya karena khawatir membuat kesalahan.', 'Antusias untuk mempelajari dan mengimplementasikannya dalam pekerjaan saya.', 'Akan menggunakannya hanya jika diperintahkan oleh atasan.', 'Membiarkan rekan-rekan yang lebih muda untuk menggunakannya.'], answer: 'Antusias untuk mempelajari dan mengimplementasikannya dalam pekerjaan saya.', explanation: 'Jawaban ini mencerminkan aspek penguasaan TIK dan semangat untuk perbaikan. ASN modern harus adaptif terhadap teknologi.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Seorang tamu dari luar kota memuji keramahan orang-orang di daerah Anda. Anda akan berkata:', options: ['"Ah, itu hanya kebetulan saja."', '"Terima kasih, kami memang bangga dengan budaya kami dan senang bisa membuat Anda nyaman."', '"Di tempat lain tidak seramah ini, ya?"', '"Sudah biasa bagi kami."', 'Diam saja sambil tersenyum.'], answer: '"Terima kasih, kami memang bangga dengan budaya kami dan senang bisa membuat Anda nyaman."', explanation: 'Jawaban ini menunjukkan kepekaan sosial budaya dan kemampuan menjadi "duta" yang baik. Anda menghargai pujian dan meresponnya dengan positif dan informatif.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Dalam sebuah diskusi, saya lebih sering menjadi...', options: ['Pendengar yang baik.', 'Orang yang mendominasi pembicaraan.', 'Orang yang memberikan ide-ide baru dan solusi.', 'Orang yang selalu setuju dengan pendapat mayoritas.', 'Orang yang mengamati situasi dari jauh.'], answer: 'Orang yang memberikan ide-ide baru dan solusi.', explanation: 'Ini menunjukkan inisiatif, kreativitas, dan orientasi pada pemecahan masalah, yang merupakan bagian dari semangat berprestasi dan profesionalisme.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Jika atasan memberikan penilaian kinerja yang kurang memuaskan kepada saya, tindakan saya adalah:', options: ['Menerima dengan pasrah tanpa bertanya.', 'Tidak terima dan berdebat dengan atasan.', 'Meminta penjelasan rinci mengenai area mana yang perlu saya perbaiki dan menyusun rencana pengembangan diri.', 'Merasa atasan tidak adil dan membencinya.', 'Membandingkan nilai saya dengan rekan kerja lain.'], answer: 'Meminta penjelasan rinci mengenai area mana yang perlu saya perbaiki dan menyusun rencana pengembangan diri.', explanation: 'Sikap ini proaktif, profesional, dan berorientasi pada pengembangan. Anda menggunakan umpan balik sebagai alat untuk menjadi lebih baik.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Saat bekerja, tiba-tiba listrik padam dan genset kantor rusak. Yang saya lakukan:', options: ['Langsung pulang karena tidak bisa bekerja.', 'Menunggu hingga listrik menyala kembali sambil mengobrol.', 'Mencari pekerjaan lain yang bisa dilakukan tanpa listrik, seperti merapikan arsip atau berdiskusi dengan tim.', 'Menyalahkan bagian umum yang tidak merawat genset.', 'Pergi ke kafe untuk melanjutkan pekerjaan menggunakan wifi mereka.'], answer: 'Mencari pekerjaan lain yang bisa dilakukan tanpa listrik, seperti merapikan arsip atau berdiskusi dengan tim.', explanation: 'Ini menunjukkan inisiatif dan kemampuan mencari solusi dalam keterbatasan. Anda tidak menyerah pada keadaan dan tetap produktif.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Saya lebih menghargai rekan kerja yang...', options: ['Pandai berbicara dan menghibur.', 'Sangat patuh pada atasan.', 'Memiliki integritas tinggi, bertanggung jawab, dan dapat diandalkan.', 'Selalu punya ide-ide gila.', 'Bekerja dengan sangat cepat.'], answer: 'Memiliki integritas tinggi, bertanggung jawab, dan dapat diandalkan.', explanation: 'Pilihan ini menempatkan integritas dan tanggung jawab sebagai nilai tertinggi, yang merupakan fondasi dari profesionalisme dan jejaring kerja yang sehat.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Menurut saya, perbedaan suku, agama, dan ras di lingkungan kerja adalah...', options: ['Sebuah masalah yang harus dihindari.', 'Tidak penting untuk dibahas.', 'Sebuah kekayaan yang jika dikelola dengan baik akan memperkuat tim.', 'Sumber utama konflik.', 'Hal yang membuat kerja menjadi tidak efisien.'], answer: 'Sebuah kekayaan yang jika dikelola dengan baik akan memperkuat tim.', explanation: 'Jawaban ini menunjukkan pemahaman yang mendalam tentang kebinekaan (sosial budaya) dan kematangan dalam berjejaring. Melihat perbedaan sebagai kekuatan adalah ciri pemikiran yang maju.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Apabila ada pekerjaan yang mendesak, saya terbiasa...', options: ['Menundanya hingga mendekati batas waktu.', 'Mengerjakannya sedikit demi sedikit.', 'Langsung fokus mengerjakannya hingga tuntas sesegera mungkin.', 'Merasa cemas dan tertekan.', 'Meminta bantuan rekan lain untuk mengerjakannya.'], answer: 'Langsung fokus mengerjakannya hingga tuntas sesegera mungkin.', explanation: 'Ini menunjukkan manajemen waktu yang baik, tanggung jawab, dan orientasi pada hasil. Menyelesaikan tugas penting sesegera mungkin adalah tanda profesionalisme.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Saya ditawari proyek yang sangat menguntungkan secara finansial, tetapi berisiko melanggar etika. Saya akan...', options: ['Menerimanya, yang penting tidak ketahuan.', 'Mempertimbangkannya dengan sangat hati-hati.', 'Langsung menolaknya tanpa keraguan karena etika dan integritas lebih penting dari apapun.', 'Mencari cara agar bisa mengambil proyek itu tanpa melanggar etika secara langsung.', 'Bertanya pendapat teman.'], answer: 'Langsung menolaknya tanpa keraguan karena etika dan integritas lebih penting dari apapun.', explanation: 'Integritas tidak bisa ditawar. Pilihan ini menunjukkan prinsip yang kokoh dan komitmen yang tidak tergoyahkan pada nilai-nilai etika.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Ketika ada masalah dalam tim, saya cenderung...', options: ['Menjadi bagian dari masalah.', 'Menghindar dan tidak mau terlibat.', 'Fokus mencari akar penyebab masalah dan mengusulkan solusi, bukan mencari siapa yang salah.', 'Menyalahkan pemimpin tim.', 'Mengikuti apa kata mayoritas.'], answer: 'Fokus mencari akar penyebab masalah dan mengusulkan solusi, bukan mencari siapa yang salah.', explanation: 'Ini adalah sikap seorang pemecah masalah (problem solver). Orientasi pada solusi, bukan pada konflik, adalah kunci efektivitas kerja tim.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Program pemerintah yang paling perlu didukung saat ini adalah...', options: ['Pembangunan infrastruktur fisik.', 'Reformasi birokrasi dan pemberantasan korupsi.', 'Bantuan sosial untuk masyarakat miskin.', 'Pengembangan sumber daya manusia.', 'Semua program tersebut sama pentingnya dan harus berjalan sinergis.'], answer: 'Semua program tersebut sama pentingnya dan harus berjalan sinergis.', explanation: 'Jawaban ini menunjukkan wawasan kebangsaan yang luas. Anda memahami bahwa pembangunan negara adalah sebuah sistem yang holistik dan semua sektor saling terkait.' },
    { subtest: 'Tes Karakteristik Pribadi', question: 'Jika saya menjadi pimpinan, gaya kepemimpinan yang akan saya terapkan adalah...', options: ['Otoriter, semua keputusan ada di tangan saya.', 'Memberikan kebebasan penuh pada anak buah tanpa banyak intervensi.', 'Demokratis, melibatkan anak buah dalam pengambilan keputusan, namun tetap tegas pada tujuan.', 'Santai dan bersahabat.', 'Selalu mengawasi setiap gerak-gerik anak buah.'], answer: 'Demokratis, melibatkan anak buah dalam pengambilan keputusan, namun tetap tegas pada tujuan.', explanation: 'Ini adalah gaya kepemimpinan yang ideal, menyeimbangkan antara partisipasi (membangun jejaring kerja) dan ketegasan dalam mencapai tujuan (semangat berprestasi).' },
];

// --- LOGIKA KUIS ---
document.addEventListener('DOMContentLoaded', () => {
    let currentQuestionIndex = 0;
    let userAnswers = new Array(questions.length).fill(null);
    let questionStatus = new Array(questions.length).fill('unanswered'); // unanswered, answered, doubtful
    let timerInterval;
    let currentUsername = '';

    // Element Cache
    const loginContainer = document.getElementById('login-container');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const loginBtn = document.getElementById('login-btn');
    const loginError = document.getElementById('login-error');

    const appHeader = document.querySelector('.header');
    const quizContainer = document.querySelector('.quiz-container');
    const resultPage = document.getElementById('result-page');
    
    const subtestTitleEl = document.getElementById('subtest-title');
    const questionNumberEl = document.getElementById('question-number');
    const questionTextEl = document.getElementById('question-text');
    const optionsEl = document.getElementById('options');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const doubtfulBtn = document.getElementById('doubtful-btn');
    const finishBtn = document.getElementById('finish-btn');
    const timerEl = document.getElementById('timer');
    const restartBtn = document.getElementById('restart-btn');
    const logoutBtn = document.getElementById('logout-btn');
    
    const confirmationModal = document.getElementById('confirmation-modal');
    const confirmYesBtn = document.getElementById('confirm-yes');
    const confirmNoBtn = document.getElementById('confirm-no');
    const headerInfo = document.getElementById('header-info');

    function showLoginPage() {
        loginContainer.style.display = 'flex';
        appHeader.style.display = 'none';
        quizContainer.style.display = 'none';
        resultPage.style.display = 'none';
        passwordInput.value = '';
        loginError.style.display = 'none';
    }

    function handleLogin() {
        const password = passwordInput.value;
        const username = usernameInput.value.trim();
        
        if (username === "") {
            loginError.textContent = "Username tidak boleh kosong.";
            loginError.style.display = 'block';
            return;
        }

        if (password === "ujiandiakazed.com") {
            currentUsername = username;
            loginContainer.style.display = 'none';
            appHeader.style.display = 'flex';
            quizContainer.style.display = 'flex';
            headerInfo.textContent = `Peserta: ${currentUsername}`;
            startQuiz();
        } else {
            loginError.textContent = "Password salah. Coba lagi.";
            loginError.style.display = 'block';
        }
    }
    
    function handleLogout() {
        clearInterval(timerInterval);
        showLoginPage();
    }

    function startQuiz() {
        currentQuestionIndex = 0;
        userAnswers.fill(null);
        questionStatus.fill('unanswered');
        quizContainer.style.display = 'flex';
        resultPage.style.display = 'none';
        
        setupQuestionGrids();
        displayQuestion(currentQuestionIndex);
        startTimer(40 * 60); // Waktu 40 Menit
    }

    function setupQuestionGrids() {
        const grids = {
            'Tes Karakteristik Pribadi': document.getElementById('grid-tkp'),
        };
        Object.values(grids).forEach(grid => grid.innerHTML = '');

        questions.forEach((q, index) => {
            const button = document.createElement('button');
            button.className = 'grid-button';
            button.textContent = index + 1;
            button.onclick = () => jumpToQuestion(index);
            grids[q.subtest].appendChild(button);
        });
    }

    function displayQuestion(index) {
        document.querySelector('.grid-button.current')?.classList.remove('current');
        currentQuestionIndex = index;
        const question = questions[index];

        subtestTitleEl.textContent = question.subtest;
        questionNumberEl.textContent = index + 1;
        questionTextEl.innerHTML = question.question;
        optionsEl.innerHTML = '';

        question.options.forEach(option => {
            const li = document.createElement('li');
            const label = document.createElement('label');
            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = 'option';
            radio.value = option;
            
             if (userAnswers[index] === option) {
                 radio.checked = true;
                 label.classList.add('selected');
             }
            radio.onchange = () => selectAnswer(index, option);
            
            const span = document.createElement('span');
            span.textContent = option;
            
            label.appendChild(radio);
            label.appendChild(span);
            li.appendChild(label);
            optionsEl.appendChild(li);
        });

        updateNavButtons();
        updateGridButtonStatus(index);
        document.querySelectorAll('.question-grid-container button')[index].classList.add('current');
    }

    function selectAnswer(index, answer) {
        userAnswers[index] = answer;
        document.querySelectorAll('#options label').forEach(l => l.classList.remove('selected'));
        const escapedValue = CSS.escape(answer);
        const selectedLabel = document.querySelector(`input[value="${escapedValue}"]`);
        if (selectedLabel) {
            selectedLabel.parentElement.classList.add('selected');
        }

        if (questionStatus[index] !== 'doubtful') {
            questionStatus[index] = 'answered';
        }
        updateGridButtonStatus(index);
    }
    
    function updateNavButtons() {
        prevBtn.disabled = currentQuestionIndex === 0;
        nextBtn.disabled = currentQuestionIndex === questions.length - 1;
    }
    
    function updateGridButtonStatus(index) {
        const button = document.querySelectorAll('.question-grid-container button')[index];
        if (!button) return;
        
        button.classList.remove('answered', 'doubtful', 'unanswered');

        switch (questionStatus[index]) {
            case 'answered': button.classList.add('answered'); break;
            case 'doubtful': button.classList.add('doubtful'); break;
            default: button.classList.add('unanswered'); break;
        }
        document.querySelector('.grid-button.current')?.classList.remove('current');
        document.querySelectorAll('.question-grid-container button')[currentQuestionIndex].classList.add('current');
    }

    function jumpToQuestion(index) {
        displayQuestion(index);
    }

    function startTimer(duration) {
        let timer = duration;
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            let minutes = parseInt(timer / 60, 10);
            let seconds = parseInt(timer % 60, 10);

            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            timerEl.textContent = minutes + ":" + seconds;
            
            if(timer < 300) timerEl.classList.add('low-time');

            if (--timer < 0) {
                clearInterval(timerInterval);
                finishQuiz();
            }
        }, 1000);
    }
    
    function showConfirmation() {
        confirmationModal.style.display = 'flex';
    }

    function finishQuiz() {
        clearInterval(timerInterval);
        confirmationModal.style.display = 'none';
        
        let score = 0;
        const correctQuestionNumbers = [];
        const incorrectQuestionNumbers = [];

        questions.forEach((q, index) => {
            if (userAnswers[index] === q.answer) {
                score++;
                correctQuestionNumbers.push(index + 1);
            } else {
                incorrectQuestionNumbers.push(index + 1);
            }
        });
        
        quizContainer.style.display = 'none';
        resultPage.style.display = 'block';
        appHeader.style.display = 'flex';
        headerInfo.textContent = `Hasil Ujian: ${currentUsername}`;
        
        // For TKP, we show the number of highest-score answers
        document.getElementById('final-score').textContent = `${score} Jawaban Terbaik`;
        document.getElementById('score-details').textContent = `Anda memilih ${score} dari ${questions.length} jawaban dengan skor tertinggi.`;

        // Hide subtest analysis
        document.getElementById('subtest-analysis-container').innerHTML = '';
        
        document.getElementById('correct-list').innerHTML = correctQuestionNumbers.map(n => `<li class="correct">${n}</li>`).join('');
        document.getElementById('incorrect-list').innerHTML = incorrectQuestionNumbers.map(n => `<li class="incorrect">${n}</li>`).join('');

        const reviewSection = document.getElementById('review-section');
        reviewSection.innerHTML = '';
        // Always show review for TKP
        document.getElementById('review-section-container').style.display = 'block';
        questions.forEach((q, index) => {
            const userAnswerText = userAnswers[index] || 'Tidak Dijawab';
            let reviewClass = userAnswerText === q.answer ? 'correct-answer' : 'user-answer';
            
            reviewSection.innerHTML += `
                <div class="review-item">
                    <p class="review-q-text"><strong>Soal ${index + 1}:</strong> ${q.question}</p>
                    <div class="review-answer ${userAnswerText !== q.answer ? 'user-answer' : ''}">${userAnswerText !== q.answer ? 'Pilihan Anda: ' + userAnswerText : ''}</div>
                    <div class="review-answer correct-answer">Pilihan Terbaik: ${q.answer}</div>
                    <div class="explanation"><strong>Pembahasan:</strong> ${q.explanation}</div>
                </div>
            `;
        });
    }

    // Event Listeners
    loginBtn.addEventListener('click', handleLogin);
    passwordInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') handleLogin(); });
    logoutBtn.addEventListener('click', handleLogout);
    prevBtn.addEventListener('click', () => currentQuestionIndex > 0 && displayQuestion(currentQuestionIndex - 1));
    nextBtn.addEventListener('click', () => currentQuestionIndex < questions.length - 1 && displayQuestion(currentQuestionIndex + 1));
    doubtfulBtn.addEventListener('click', () => {
        questionStatus[currentQuestionIndex] = questionStatus[currentQuestionIndex] === 'doubtful' ? (userAnswers[currentQuestionIndex] ? 'answered' : 'unanswered') : 'doubtful';
        updateGridButtonStatus(currentQuestionIndex);
    });
    finishBtn.addEventListener('click', showConfirmation);
    confirmYesBtn.addEventListener('click', finishQuiz);
    confirmNoBtn.addEventListener('click', () => confirmationModal.style.display = 'none');
    restartBtn.addEventListener('click', startQuiz);

    // Initialize
    showLoginPage();
});
</script>
