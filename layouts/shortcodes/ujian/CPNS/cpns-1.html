    <style>
        :root {
            --primary-bg: #f0f2f5;
            --panel-bg: #ffffff;
            --header-bg: #0d47a1; /* Biru Tua */
            --header-text: #ffffff;
            --text-color: #333333;
            --border-color: #dee2e6;
            --primary-action-bg: #1976d2; /* Biru */
            --primary-action-hover: #1565c0;
            --answered-bg: #4caf50; /* Hijau */
            --correct-bg: #e8f5e9;
            --correct-text: #2e7d32;
            --incorrect-bg: #ffebee;
            --incorrect-text: #c62828;
            --doubtful-bg: #ffc107; /* Kuning */
            --current-bg: #ff9800; /* Oranye */
            --unanswered-bg: #ffffff;
            --timer-alert: #d32f2f; /* Merah */
        }
        
        /* --- Halaman Login --- */
        #login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-grow: 1;
            padding: 20px;
        }
        .login-box {
            background-color: var(--panel-bg);
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        .login-box h2 {
            margin-top: 0;
            margin-bottom: 25px;
            color: var(--header-bg);
        }
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box;
        }
        #login-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-action-bg);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #login-btn:hover {
            background-color: var(--primary-action-hover);
        }
        #login-error {
            color: var(--timer-alert);
            margin-top: 15px;
            font-weight: 500;
            display: none;
        }

        /* Header */
        .header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header h2 {
            font-size: 1.2em;
            margin: 0;
        }
        .user-info {
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        #logout-btn {
            background: none;
            border: 1px solid var(--header-text);
            color: var(--header-text);
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #logout-btn:hover {
            background-color: rgba(255,255,255,0.1);
        }


        /* Main Container */
        .quiz-container {
            display: flex;
            flex: 1;
            padding: 15px;
            gap: 15px;
            overflow: hidden;
            height: calc(100vh - 58px); /* Adjusted for header height */
        }

        /* Question Panel (Left) */
        .question-panel {
            flex: 3;
            background-color: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .question-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            background-color: #f8f9fa;
        }
        .question-header #subtest-title {
            font-weight: 700;
            color: var(--header-bg);
        }
        .question-body {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
            line-height: 1.6;
        }
        .question-text {
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        .options-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .options-list li {
            margin-bottom: 10px;
        }
        .options-list label {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .options-list label:hover {
            background-color: #e3f2fd;
        }
        .options-list input[type="radio"] {
            margin-right: 15px;
            margin-top: 5px;
        }
        .options-list input[type="radio"]:checked + span {
            font-weight: 700;
        }
        .options-list label.selected {
            background-color: #bbdefb;
            border-color: var(--primary-action-bg);
        }

        /* Navigation Panel (Right) */
        .navigation-panel {
            flex: 1.2;
            background-color: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            min-width: 300px;
        }
        .timer-box {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }
        #timer {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--header-bg);
            letter-spacing: 2px;
        }
        #timer.low-time {
            color: var(--timer-alert);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .question-grid-container {
            padding: 15px;
            flex: 1;
            overflow-y: auto;
        }
        .subtest-group {
            margin-bottom: 15px;
        }
        .subtest-group h3 {
            font-size: 0.9em;
            margin: 0 0 10px 0;
            color: var(--text-color);
            border-bottom: 2px solid var(--primary-action-bg);
            padding-bottom: 5px;
        }
        .question-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 8px;
        }
        .grid-button {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border-color);
            background-color: var(--unanswered-bg);
            cursor: pointer;
            border-radius: 5px;
            font-weight: 500;
            transition: all 0.2s;
        }
        .grid-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .grid-button.answered { background-color: var(--answered-bg); color: white; border-color: var(--answered-bg); }
        .grid-button.doubtful { background-color: var(--doubtful-bg); border-color: var(--doubtful-bg); }
        .grid-button.current { border: 2px solid var(--current-bg); }

        /* Footer / Actions */
        .quiz-actions {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8f9fa;
        }
        .action-button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 700;
            transition: background-color 0.2s;
        }
        #prev-btn, #next-btn {
            background-color: var(--primary-action-bg);
            color: white;
        }
        #prev-btn:disabled, #next-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #doubtful-btn {
            background-color: var(--doubtful-bg);
            color: #333;
        }
        #finish-btn {
            background-color: var(--timer-alert);
            color: white;
        }

        /* Confirmation Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            animation: slide-down 0.3s ease-out;
        }
        @keyframes slide-down {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-content h2 {
            margin-top: 0;
            color: var(--header-bg);
        }
        .modal-actions {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        #confirm-yes {
            background-color: var(--primary-action-bg);
            color: white;
        }
        #confirm-no {
            background-color: #6c757d;
            color: white;
        }
        
        /* --- Result Page Styles --- */
        .result-container {
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        .result-container h2, .result-container h3 {
            color: var(--header-bg);
        }
        .result-card {
            background-color: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .overall-summary {
            text-align: center;
        }
        .overall-summary .score {
            font-size: 3em;
            font-weight: 700;
            color: var(--answered-bg);
        }
        .overall-summary .score-details {
            font-size: 1.1em;
            color: var(--text-color);
        }
        .subtest-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .subtest-card {
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            text-align: center;
        }
        .subtest-card h4 {
            margin: 0 0 10px 0;
        }
        .subtest-card .subtest-score {
            font-size: 1.5em;
            font-weight: 500;
        }

        .answer-list {
            padding: 0;
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .answer-list li {
            width: 35px;
            height: 35px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            font-weight: 500;
        }
        .answer-list li.correct {
            background-color: var(--correct-text);
            color: white;
        }
        .answer-list li.incorrect {
            background-color: var(--incorrect-text);
            color: white;
        }
        
        .review-item {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        .review-item .review-q-text {
            font-weight: 500;
        }
        .review-item .review-answer {
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
        }
        .review-item .user-answer {
            background-color: var(--incorrect-bg);
            border-left: 4px solid var(--incorrect-text);
            color: var(--incorrect-text);
        }
        .review-item .correct-answer {
            background-color: var(--correct-bg);
            border-left: 4px solid var(--correct-text);
            color: var(--correct-text);
        }
        .review-item .explanation {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-style: italic;
        }
        #restart-btn {
            margin-top: 20px;
            padding: 12px 25px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: var(--primary-action-bg);
            color: white;
        }
        
        /* Hidden by default */
        .header, .quiz-container, #result-page {
            display: none;
        }
        
        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            .quiz-container {
                flex-direction: column;
                height: auto;
                overflow: visible;
            }
            .navigation-panel {
                min-width: unset;
                flex: unset; /* Unset flex grow/shrink */
                height: auto;
            }
            .question-panel {
                min-height: 40vh;
            }
            .header h2 {
                font-size: 1em;
            }
        }
        
        @media (max-width: 480px) {
            .login-box {
                padding: 20px;
            }
            .question-body, .quiz-actions {
                padding: 15px;
            }
            .action-button {
                padding: 8px 12px;
                font-size: 0.9em;
            }
        }

    </style>
    
    <div id="login-container">
        <div class="login-box">
            <h2>Login Peserta Ujian</h2>
            <div class="input-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Masukkan username Anda">
            </div>
            <div class="input-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Masukkan password">
            </div>
            <button id="login-btn">Masuk</button>
            <p id="login-error">Password salah. Coba lagi.</p>
        </div>
    </div>

    <header class="header">
        <h2>Tryout Seleksi CPNS (SKD)</h2>
        <div class="user-info">
            <span id="header-info"></span>
            <button id="logout-btn">Logout</button>
        </div>
    </header>

    <div class="quiz-container">
        <main class="question-panel">
            <div class="question-header">
                <span id="subtest-title">Subtes</span> | Soal No. <span id="question-number">1</span>
            </div>
            <div class="question-body">
                <p id="question-text">Memuat soal...</p>
                <ul id="options" class="options-list"></ul>
            </div>
            <div class="quiz-actions">
                <button id="prev-btn" class="action-button">Sebelumnya</button>
                <button id="doubtful-btn" class="action-button">Ragu-ragu</button>
                <button id="next-btn" class="action-button">Selanjutnya</button>
            </div>
        </main>

        <aside class="navigation-panel">
            <div class="timer-box">
                Sisa Waktu
                <div id="timer">120:00</div>
            </div>
            <div class="question-grid-container">
                <div class="subtest-group">
                    <h3>Tes Wawasan Kebangsaan (TWK) (1-30)</h3>
                    <div id="grid-twk" class="question-grid"></div>
                </div>
                <div class="subtest-group">
                    <h3>Tes Intelegensia Umum (TIU) (31-65)</h3>
                    <div id="grid-tiu" class="question-grid"></div>
                </div>
                <div class="subtest-group">
                    <h3>Tes Karakteristik Pribadi (TKP) (66-110)</h3>
                    <div id="grid-tkp" class="question-grid"></div>
                </div>
            </div>
            <div class="quiz-actions" style="justify-content: center;">
                <button id="finish-btn" class="action-button">Selesaikan Ujian</button>
            </div>
        </aside>
    </div>

    <div id="result-page" class="result-container">
        <div class="result-card overall-summary">
            <h2>Hasil Akhir Ujian</h2>
            <div id="final-score" class="score">0%</div>
            <div id="score-details" class="score-details"></div>
            <div id="subtest-analysis-container" class="subtest-analysis"></div>
        </div>
        
        <div class="result-card">
            <h3>Rekap Jawaban</h3>
            <h4>Jawaban Benar</h4>
            <ul id="correct-list" class="answer-list"></ul>
            <h4 style="margin-top: 20px;">Jawaban Salah / Kosong</h4>
            <ul id="incorrect-list" class="answer-list"></ul>
        </div>
        
        <div id="review-section-container" class="result-card">
            <h3>Pembahasan Jawaban Salah</h3>
            <div id="review-section"></div>
        </div>
         
        <div style="text-align: center;">
           <button id="restart-btn" class="action-button">Ulangi Ujian</button>
        </div>
    </div>
    
    <div id="confirmation-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Selesaikan Ujian?</h2>
            <p>Apakah Anda yakin ingin menyelesaikan dan mengakhiri sesi ujian ini?</p>
            <div class="modal-actions">
                <button id="confirm-no" class="action-button">Batal</button>
                <button id="confirm-yes" class="action-button">Ya, Selesaikan</button>
            </div>
        </div>
    </div>


<script>
// --- DATABASE SOAL CPNS ---
const questions = [
    // --- TES WAWASAN KEBANGSAAN (TWK) - 30 Soal ---
    { subtest: 'Tes Wawasan Kebangsaan (TWK)', question: 'Yang dimaksud dengan wawasan kebangsaan adalah, kecuali...', options: ['Cara pandang bangsa Indonesia tentang diri dan lingkungannya', 'Mengutamakan persatuan dan kesatuan bangsa', 'Mengutamakan kesatuan wilayah dalam penyelenggaraan kehidupan bermasyarakat, berbangsa, dan bernegara', 'Cara pandang yang menganggap suku bangsanya lebih superior dari yang lain'], answer: 'Cara pandang yang menganggap suku bangsanya lebih superior dari yang lain', explanation: 'Wawasan kebangsaan menekankan persatuan dan kesatuan, bukan superioritas suku atau golongan (chauvinisme).' },
    { subtest: 'Tes Wawasan Kebangsaan (TWK)', question: 'Pancasila sebagai dasar negara Republik Indonesia secara yuridis formal tercantum dalam...', options: ['Pembukaan UUD 1945 alinea keempat', 'Pasal 1 ayat (3) UUD 1945', 'Ketetapan MPR No. III/MPR/2000', 'Piagam Jakarta'], answer: 'Pembukaan UUD 1945 alinea keempat', explanation: 'Rumusan Pancasila sebagai dasar negara secara resmi tercantum dalam Pembukaan UUD 1945 pada alinea keempat.' },
    { subtest: 'Tes Wawasan Kebangsaan (TWK)', question: 'Perjanjian yang mengakhiri konfrontasi Indonesia-Malaysia pada tahun 1966 dikenal dengan nama...', options: ['Perjanjian Linggarjati', 'Perjanjian Renville', 'Deklarasi Bangkok', 'Persetujuan Jakarta (Jakarta Accord)'], answer: 'Persetujuan Jakarta (Jakarta Accord)', explanation: 'Persetujuan Jakarta (Jakarta Accord) yang ditandatangani pada 11 Agustus 1966 secara resmi mengakhiri periode konfrontasi antara Indonesia dan Malaysia.' },
    { subtest: 'Tes Wawasan Kebangsaan (TWK)', question: 'Fungsi bahasa Indonesia dalam kedudukannya sebagai bahasa nasional adalah sebagai berikut, kecuali...', options: ['Lambang kebanggaan nasional', 'Alat pemersatu berbagai suku bangsa', 'Bahasa resmi dalam pengembangan kebudayaan dan pemanfaatan iptek', 'Lambang identitas daerah'], answer: 'Lambang identitas daerah', explanation: 'Bahasa Indonesia berfungsi sebagai lambang identitas nasional, bukan daerah. Identitas daerah dilambangkan oleh bahasa daerah masing-masing.' },
    { subtest: 'Tes Wawasan Kebangsaan (TWK)', question: 'Dalam sistem pertahanan dan keamanan rakyat semesta (Sishankamrata), komponen utama adalah...', options: ['TNI dan POLRI', 'Rakyat terlatih', 'Perlindungan Masyarakat (Linmas)', 'TNI'], answer: 'TNI', explanation: 'Dalam Sishankamrata, TNI berperan sebagai komponen utama, sementara POLRI, rakyat terlatih, dan komponen lainnya bertindak sebagai komponen cadangan dan pendukung.' },
    { subtest: 'Tes Wawasan Kebangsaan (TWK)', question: 'Pilar-pilar kebangsaan yang menjadi penyangga utama keutuhan Negara Kesatuan Republik Indonesia (NKRI) adalah...', options: ['Pancasila, UUD 1945, NKRI, dan Bhinneka Tunggal Ika', 'Pancasila, Presiden, TNI, dan Rakyat', 'UUD 1945, Lembaga Negara, dan Pemerintah Daerah', 'Demokrasi, Hak Asasi Manusia, dan Keadilan Sosial'], answer: 'Pancasila, UUD 1945, NKRI, dan Bhinneka Tunggal Ika', explanation: 'Empat pilar kebangsaan yang menjadi konsensus dasar adalah Pancasila, UUD 1945, NKRI, dan semboyan Bhinneka Tunggal Ika.' },
    { subtest: 'Tes Wawasan Kebangsaan (TWK)', question: 'Makna yang terkandung dalam Bhinneka Tunggal Ika adalah...', options: ['Walaupun berbeda-beda tetapi tetap satu jua', 'Perbedaan harus diseragamkan', 'Persatuan tanpa memandang perbedaan', 'Keberagaman adalah sumber perpecahan'], answer: 'Walaupun berbeda-beda tetapi tetap satu jua', explanation: 'Bhinneka Tunggal Ika secara harfiah berarti "Berbeda-beda tetapi tetap satu," yang melambangkan persatuan dalam keragaman bangsa Indonesia.' },
    { subtest: 'Tes Wawasan Kebangsaan (TWK)', question: 'Sikap positif terhadap nilai-nilai Pancasila, terutama sila kedua, dalam kehidupan sehari-hari diwujudkan dengan...', options: ['Mengembangkan sikap tenggang rasa dan tidak semena-mena terhadap orang lain', 'Percaya dan takwa kepada Tuhan Yang Maha Esa', 'Mengutamakan musyawarah dalam mengambil keputusan', 'Rela berkorban untuk kepentingan bangsa dan negara'], answer: 'Mengembangkan sikap tenggang rasa dan tidak semena-mena terhadap orang lain', explanation: 'Sila kedua, "Kemanusiaan yang Adil dan Beradab", menekankan pada pengakuan persamaan derajat, hak, dan kewajiban serta mengembangkan sikap tenggang rasa.' },
    { subtest: 'Tes Wawasan Kebangsaan (TWK)', question: 'Salah satu bentuk pengamalan integritas nasional bagi seorang ASN adalah...', options: ['Menolak segala bentuk gratifikasi yang berhubungan dengan jabatannya', 'Bekerja sesuai dengan perintah atasan meskipun bertentangan dengan aturan', 'Memberikan pelayanan khusus kepada kerabat', 'Menggunakan fasilitas kantor untuk kepentingan pribadi di luar jam kerja'], answer: 'Menolak segala bentuk gratifikasi yang berhubungan dengan jabatannya', explanation: 'Integritas berarti konsistensi antara perkataan dan perbuatan. Menolak gratifikasi adalah wujud nyata dari integritas seorang ASN dalam menjaga amanah jabatannya.' },
    { subtest: 'Tes Wawasan Kebangsaan (TWK)', question: 'Lagu kebangsaan Indonesia Raya pertama kali diperdengarkan secara resmi pada saat...', options: ['Kongres Pemuda II tanggal 28 Oktober 1928', 'Proklamasi Kemerdekaan 17 Agustus 1945', 'Sidang BPUPKI pertama', 'Peristiwa Rengasdengklok'], answer: 'Kongres Pemuda II tanggal 28 Oktober 1928', explanation: 'Lagu Indonesia Raya karya W.R. Supratman pertama kali diperdengarkan dengan biola (tanpa lirik) pada saat penutupan Kongres Pemuda II.' },
    ...Array(20).fill({ subtest: 'Tes Wawasan Kebangsaan (TWK)', question: 'Contoh Soal TWK: Lambang negara Garuda Pancasila diatur penggunaannya dalam...', options: ['UU No. 24 Tahun 2009', 'UU No. 9 Tahun 1998', 'Peraturan Pemerintah No. 66 Tahun 1951', 'UUD 1945 Pasal 36A'], answer: 'UU No. 24 Tahun 2009', explanation: 'UU No. 24 Tahun 2009 mengatur tentang Bendera, Bahasa, dan Lambang Negara, serta Lagu Kebangsaan.' }),

    // --- TES INTELEGENSIA UMUM (TIU) - 35 Soal ---
    { subtest: 'Tes Intelegensia Umum (TIU)', question: 'INSOMNIA : ... = ... : MAKAN', options: ['TIDUR : LAPAR', 'MALAM : NASI', 'OBAT : MINUM', 'LELAH : KENYANG'], answer: 'TIDUR : LAPAR', explanation: 'INSOMNIA adalah kondisi kesulitan TIDUR. LAPAR adalah kondisi kesulitan (kebutuhan) untuk MAKAN. Ini adalah analogi hubungan "kondisi : kebutuhan/aktivitas".' },
    { subtest: 'Tes Intelegensia Umum (TIU)', question: 'Antonim dari kata "PROMINEN" adalah...', options: ['Biasa', 'Terkenal', 'Unggul', 'Menonjol'], answer: 'Biasa', explanation: 'Prominen berarti menonjol atau terkenal. Lawan katanya adalah biasa atau tidak dikenal.' },
    { subtest: 'Tes Intelegensia Umum (TIU)', question: 'Seri Angka: 4, 8, 10, 20, 22, ...', options: ['44', '32', '24', '42'], answer: '44', explanation: 'Pola deret adalah x2, +2, x2, +2, ... Maka angka selanjutnya adalah 22 x 2 = 44.' },
    { subtest: 'Tes Intelegensia Umum (TIU)', question: 'Jika x adalah 15% dari 200, dan y adalah akar kuadrat dari 900, maka...', options: ['x = y', 'x < y', 'x > y', 'Hubungan x dan y tidak dapat ditentukan'], answer: 'x = y', explanation: 'x = 0.15 * 200 = 30. y = âˆš900 = 30. Jadi, x = y.' },
    { subtest: 'Tes Intelegensia Umum (TIU)', question: 'Semua karyawan harus hadir dalam rapat rutin. Tono adalah seorang office boy. Kesimpulan yang paling tepat adalah...', options: ['Tono tidak perlu hadir dalam rapat rutin', 'Tono adalah seorang karyawan, maka ia harus hadir dalam rapat rutin', 'Meskipun Tono seorang karyawan, ia tidak harus hadir', 'Tidak dapat ditarik kesimpulan'], answer: 'Tidak dapat ditarik kesimpulan', explanation: 'Premis tidak menyatakan bahwa office boy adalah bagian dari "karyawan" yang diwajibkan rapat. Hubungan antara office boy dan karyawan tidak didefinisikan, sehingga kesimpulan tidak bisa ditarik.' },
    { subtest: 'Tes Intelegensia Umum (TIU)', question: 'Sebuah mobil menempuh jarak 120 km dalam 2 jam. Jika mobil tersebut ingin menempuh jarak 180 km, berapa waktu yang dibutuhkan?', options: ['2.5 jam', '3 jam', '3.5 jam', '4 jam'], answer: '3 jam', explanation: 'Kecepatan mobil = Jarak / Waktu = 120 km / 2 jam = 60 km/jam. Waktu untuk 180 km = Jarak / Kecepatan = 180 km / 60 km/jam = 3 jam.' },
    { subtest: 'Tes Intelegensia Umum (TIU)', question: 'Sinonim dari kata "ADAGIUM" adalah...', options: ['Pepatah', 'Paragraf', 'Hipotesis', 'Kaidah'], answer: 'Pepatah', explanation: 'Adagium adalah peribahasa atau pepatah.' },
    { subtest: 'Tes Intelegensia Umum (TIU)', question: 'Sebuah proyek dapat diselesaikan oleh 8 orang dalam 15 hari. Jika proyek ingin diselesaikan dalam 12 hari, berapa banyak tambahan pekerja yang dibutuhkan?', options: ['2 orang', '3 orang', '4 orang', '5 orang'], answer: '2 orang', explanation: 'Ini adalah perbandingan berbalik nilai. Total pekerjaan = 8 orang * 15 hari = 120. Jumlah pekerja untuk 12 hari = 120 / 12 hari = 10 orang. Tambahan pekerja = 10 - 8 = 2 orang.' },
    { subtest: 'Tes Intelegensia Umum (TIU)', question: 'Pilihlah gambar selanjutnya dari seri berikut.', options: ['[Opsi Gambar A]', '[Opsi Gambar B]', '[Opsi Gambar C]', '[Opsi Gambar D]'], answer: '[Opsi Gambar A]', explanation: 'Pada soal figural, jawaban dan penjelasan akan bergantung pada gambar yang disajikan. Contoh: Pola rotasi searah jarum jam sebesar 45 derajat.' },
    { subtest: 'Tes Intelegensia Umum (TIU)', question: 'Seri Huruf: A, C, F, J, O, ...', options: ['U', 'T', 'S', 'V'], answer: 'U', explanation: 'Pola loncatan huruf: +2, +3, +4, +5. Maka huruf selanjutnya adalah O + 6 langkah = U.' },
    ...Array(25).fill({ subtest: 'Tes Intelegensia Umum (TIU)', question: 'Contoh Soal TIU: Berapakah 37,5% dari 240?', options: ['90', '80', '70', '100'], answer: '90', explanation: '37,5% sama dengan 3/8. Maka 3/8 * 240 = 3 * 30 = 90.' }),

    // --- TES KARAKTERISTIK PRIBADI (TKP) - 45 Soal ---
    { subtest: 'Tes Karakteristik Pribadi (TKP)', question: 'Anda ditugaskan oleh atasan untuk menyelesaikan sebuah pekerjaan yang sangat mendesak. Namun, seorang rekan kerja datang meminta bantuan Anda untuk menyelesaikan pekerjaannya yang juga memiliki tenggat waktu. Sikap Anda:', options: ['Menolak permintaannya karena tugas saya lebih penting.', 'Membantunya setelah pekerjaan saya selesai sepenuhnya, tidak peduli waktunya cukup atau tidak.', 'Menjelaskan prioritas pekerjaan saya dan menyarankannya meminta bantuan rekan lain yang lebih longgar.', 'Membantunya sebentar lalu kembali ke pekerjaan saya.', 'Mengajak rekan kerja lain untuk membantunya.'], answer: 'Menjelaskan prioritas pekerjaan saya dan menyarankannya meminta bantuan rekan lain yang lebih longgar.', explanation: 'Jawaban ini menunjukkan profesionalisme, fokus pada tanggung jawab utama, sambil tetap menunjukkan kepedulian (kolaborasi) dengan memberikan solusi alternatif. Ini adalah jawaban dengan skor tertinggi (5).' },
    { subtest: 'Tes Karakteristik Pribadi (TKP)', question: 'Di kantor Anda, diterapkan sistem teknologi informasi baru untuk meningkatkan efisiensi. Namun, Anda merasa kesulitan dan lebih lambat saat menggunakannya dibandingkan cara manual. Apa yang akan Anda lakukan?', options: ['Meminta atasan untuk mengizinkan saya tetap menggunakan cara manual.', 'Berusaha mempelajarinya di waktu luang dan bertanya kepada rekan yang lebih mahir.', 'Mengeluh kepada rekan kerja lain tentang sulitnya sistem baru.', 'Hanya menggunakan sistem baru jika diawasi oleh atasan.', 'Menunggu pelatihan resmi diadakan untuk semua karyawan.'], answer: 'Berusaha mempelajarinya di waktu luang dan bertanya kepada rekan yang lebih mahir.', explanation: 'Ini menunjukkan kemauan belajar yang tinggi, adaptasi terhadap teknologi (pengembangan diri), dan inisiatif untuk mengatasi kesulitan. Skor tertinggi (5).' },
    { subtest: 'Tes Karakteristik Pribadi (TKP)', question: 'Seorang warga memberikan Anda sejumlah uang "terima kasih" setelah Anda membantunya mengurus perizinan dengan cepat sesuai prosedur. Sikap Anda:', options: ['Menerimanya karena itu adalah bentuk apresiasi dan bukan suap.', 'Menolaknya dengan halus dan menjelaskan bahwa pelayanan yang diberikan adalah kewajiban saya sebagai ASN.', 'Menerimanya dan melaporkannya kepada atasan.', 'Menolaknya dengan tegas di depan warga lain agar menjadi contoh.', 'Menyarankan agar uang tersebut dimasukkan ke kotak sumbangan yang ada di kantor.'], answer: 'Menolaknya dengan halus dan menjelaskan bahwa pelayanan yang diberikan adalah kewajiban saya sebagai ASN.', explanation: 'Sikap ini menunjukkan integritas tertinggi dengan menolak gratifikasi secara sopan dan edukatif, menegaskan bahwa pelayanan prima adalah standar kerja tanpa pamrih. Skor tertinggi (5).' },
    { subtest: 'Tes Karakteristik Pribadi (TKP)', question: 'Tim Anda mengalami kegagalan dalam mencapai target yang telah ditetapkan. Sebagai anggota tim, apa yang Anda lakukan?', options: ['Mencari siapa yang menjadi penyebab utama kegagalan tersebut.', 'Menerima kegagalan tersebut sebagai hal yang biasa terjadi.', 'Mengajak seluruh anggota tim untuk introspeksi, mengevaluasi kesalahan bersama, dan merencanakan perbaikan.', 'Merasa kecewa dan kehilangan motivasi untuk proyek selanjutnya.', 'Melaporkan kepada atasan bahwa target yang diberikan tidak realistis.'], answer: 'Mengajak seluruh anggota tim untuk introspeksi, mengevaluasi kesalahan bersama, dan merencanakan perbaikan.', explanation: 'Jawaban ini menunjukkan semangat kerja sama, orientasi pada hasil, kemampuan introspeksi, dan sikap konstruktif untuk perbaikan di masa depan. Skor tertinggi (5).' },
    { subtest: 'Tes Karakteristik Pribadi (TKP)', question: 'Anda dipindahkan ke unit kerja baru yang sebagian besar pegawainya berasal dari latar belakang suku dan budaya yang sangat berbeda dengan Anda. Sikap Anda adalah:', options: ['Berusaha memahami adat dan kebiasaan mereka agar dapat beradaptasi dan bekerja sama dengan baik.', 'Menjaga jarak karena khawatir terjadi kesalahpahaman budaya.', 'Hanya bergaul dengan rekan yang memiliki kesamaan latar belakang dengan saya.', 'Meminta mereka untuk mengikuti cara saya bekerja agar tidak ada perbedaan.', 'Bekerja secara individualis agar tidak menimbulkan konflik.'], answer: 'Berusaha memahami adat dan kebiasaan mereka agar dapat beradaptasi dan bekerja sama dengan baik.', explanation: 'Ini mencerminkan kemampuan beradaptasi, orientasi sosial-kultural, dan kemampuan membangun jejaring kerja yang baik di lingkungan yang beragam. Skor tertinggi (5).' },
    { subtest: 'Tes Karakteristik Pribadi (TKP)', question: 'Atasan Anda memberikan kritik yang sangat tajam dan menurut Anda tidak sepenuhnya objektif mengenai hasil kerja Anda. Reaksi Anda adalah:', options: ['Mendengarkan dengan tenang, berterima kasih atas masukannya, dan akan menjadikannya bahan untuk introspeksi.', 'Mendebatnya dengan argumen dan data untuk membuktikan bahwa kritiknya salah.', 'Menerima kritik tersebut dengan perasaan tertekan dan kecewa.', 'Mengabaikan kritik tersebut karena merasa tidak benar.', 'Menceritakan hal ini kepada rekan kerja untuk mencari pembenaran.'], answer: 'Mendengarkan dengan tenang, berterima kasih atas masukannya, dan akan menjadikannya bahan untuk introspeksi.', explanation: 'Sikap ini menunjukkan kematangan emosional, keterbukaan terhadap masukan, dan sikap profesional dalam menghadapi kritik, meskipun terasa tidak adil. Skor tertinggi (5).' },
    { subtest: 'Tes Karakteristik Pribadi (TKP)', question: 'Saat sedang sibuk bekerja, website media sosial favorit Anda mengeluarkan fitur terbaru. Apa yang Anda lakukan?', options: ['Langsung membukanya untuk melihat fitur tersebut karena penasaran.', 'Menyelesaikan dulu pekerjaan prioritas, baru melihatnya saat jam istirahat atau setelah jam kerja.', 'Mengabaikannya sama sekali karena media sosial tidak penting.', 'Membukanya sebentar saja, tidak lebih dari 5 menit.', 'Mengajak rekan kerja untuk melihatnya bersama-sama.'], answer: 'Menyelesaikan dulu pekerjaan prioritas, baru melihatnya saat jam istirahat atau setelah jam kerja.', explanation: 'Ini menunjukkan kemampuan mengelola diri (self-management), disiplin, dan fokus pada prioritas pekerjaan, yang merupakan ciri profesionalisme. Skor tertinggi (5).' },
    { subtest: 'Tes Karakteristik Pribadi (TKP)', question: 'Anda menemukan ada rekan kerja yang sering menggunakan fasilitas internet kantor untuk mengunduh film dan game. Sikap Anda:', options: ['Menegurnya secara langsung karena itu melanggar aturan.', 'Melaporkannya diam-diam kepada atasan atau bagian SDM.', 'Mendiamkannya karena bukan urusan saya.', 'Menasihatinya secara personal dan baik-baik tentang risiko dan aturan yang berlaku.', 'Ikut menggunakan fasilitas tersebut selagi tidak ketahuan.'], answer: 'Menasihatinya secara personal dan baik-baik tentang risiko dan aturan yang berlaku.', explanation: 'Jawaban ini adalah pilihan paling bijak, menunjukkan kepedulian (integritas dan etika) sambil menjaga hubungan baik dengan rekan kerja. Ini lebih konstruktif daripada langsung melaporkan atau menegur dengan keras. Skor tertinggi (5).' },
    ...Array(37).fill({ subtest: 'Tes Karakteristik Pribadi (TKP)', question: 'Contoh Soal TKP: Menurut Anda, seorang ASN yang profesional adalah yang...', options: ['Bekerja keras hingga larut malam setiap hari.', 'Selalu menuruti semua perintah atasan tanpa bertanya.', 'Memiliki kompetensi tinggi dan mematuhi kode etik jabatannya.', 'Mampu mengerjakan banyak tugas sekaligus (multitasking).', 'Memiliki hubungan yang baik dengan semua rekan kerja.'], answer: 'Memiliki kompetensi tinggi dan mematuhi kode etik jabatannya.', explanation: 'Profesionalisme mencakup dua aspek utama: kompetensi teknis (kemampuan) dan integritas (kepatuhan pada kode etik). Ini adalah definisi yang paling lengkap dan ideal. Skor tertinggi (5).' }),
];
// --- LOGIKA KUIS ---
document.addEventListener('DOMContentLoaded', () => {
    let currentQuestionIndex = 0;
    let userAnswers = new Array(questions.length).fill(null);
    let questionStatus = new Array(questions.length).fill('unanswered'); // unanswered, answered, doubtful
    let timerInterval;
    let currentUsername = '';

    // Element Cache
    const loginContainer = document.getElementById('login-container');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const loginBtn = document.getElementById('login-btn');
    const loginError = document.getElementById('login-error');

    const appHeader = document.querySelector('.header');
    const quizContainer = document.querySelector('.quiz-container');
    const resultPage = document.getElementById('result-page');
    
    const subtestTitleEl = document.getElementById('subtest-title');
    const questionNumberEl = document.getElementById('question-number');
    const questionTextEl = document.getElementById('question-text');
    const optionsEl = document.getElementById('options');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const doubtfulBtn = document.getElementById('doubtful-btn');
    const finishBtn = document.getElementById('finish-btn');
    const timerEl = document.getElementById('timer');
    const restartBtn = document.getElementById('restart-btn');
    const logoutBtn = document.getElementById('logout-btn');
    
    const confirmationModal = document.getElementById('confirmation-modal');
    const confirmYesBtn = document.getElementById('confirm-yes');
    const confirmNoBtn = document.getElementById('confirm-no');
    const headerInfo = document.getElementById('header-info');

    function showLoginPage() {
        loginContainer.style.display = 'flex';
        appHeader.style.display = 'none';
        quizContainer.style.display = 'none';
        resultPage.style.display = 'none';
        passwordInput.value = '';
        loginError.style.display = 'none';
    }

    function handleLogin() {
        const password = passwordInput.value;
        const username = usernameInput.value.trim();
        
        if (username === "") {
            loginError.textContent = "Username tidak boleh kosong.";
            loginError.style.display = 'block';
            return;
        }

        if (password === "ujiandiakazed.com") {
            currentUsername = username;
            loginContainer.style.display = 'none';
            appHeader.style.display = 'flex';
            quizContainer.style.display = 'flex';
            headerInfo.textContent = `Peserta: ${currentUsername}`;
            startQuiz();
        } else {
            loginError.textContent = "Password salah. Coba lagi.";
            loginError.style.display = 'block';
        }
    }
    
    function handleLogout() {
        clearInterval(timerInterval);
        showLoginPage();
    }

    function startQuiz() {
        currentQuestionIndex = 0;
        userAnswers.fill(null);
        questionStatus.fill('unanswered');
        quizContainer.style.display = 'flex';
        resultPage.style.display = 'none';
        
        setupQuestionGrids();
        displayQuestion(currentQuestionIndex);
        startTimer(120 * 60); // Waktu 120 Menit
    }

    function setupQuestionGrids() {
        // Updated for CPNS Subtests
        const grids = {
            'Tes Wawasan Kebangsaan (TWK)': document.getElementById('grid-twk'),
            'Tes Intelegensia Umum (TIU)': document.getElementById('grid-tiu'),
            'Tes Karakteristik Pribadi (TKP)': document.getElementById('grid-tkp')
        };
        Object.values(grids).forEach(grid => grid.innerHTML = '');

        questions.forEach((q, index) => {
            const button = document.createElement('button');
            button.className = 'grid-button';
            button.textContent = index + 1;
            button.onclick = () => jumpToQuestion(index);
            // Append to the correct subtest grid
            grids[q.subtest].appendChild(button);
        });
    }

    function displayQuestion(index) {
        document.querySelector('.grid-button.current')?.classList.remove('current');
        currentQuestionIndex = index;
        const question = questions[index];

        subtestTitleEl.textContent = question.subtest;
        questionNumberEl.textContent = index + 1;
        questionTextEl.innerHTML = question.question;
        optionsEl.innerHTML = '';

        question.options.forEach(option => {
            const li = document.createElement('li');
            const label = document.createElement('label');
            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = 'option';
            radio.value = option;
            
             if (userAnswers[index] === option) {
                radio.checked = true;
                label.classList.add('selected');
            }
            radio.onchange = () => selectAnswer(index, option);
            
            const span = document.createElement('span');
            span.textContent = option;
            
            label.appendChild(radio);
            label.appendChild(span);
            li.appendChild(label);
            optionsEl.appendChild(li);
        });

        updateNavButtons();
        updateGridButtonStatus(index);
        document.querySelectorAll('.question-grid-container button')[index].classList.add('current');
    }

    function selectAnswer(index, answer) {
        userAnswers[index] = answer;
        document.querySelectorAll('#options label').forEach(l => l.classList.remove('selected'));
        // Use CSS.escape for values that might contain special characters
        const escapedValue = CSS.escape(answer);
        const selectedLabel = document.querySelector(`input[value="${escapedValue}"]`);
        if (selectedLabel) {
            selectedLabel.parentElement.classList.add('selected');
        }

        if (questionStatus[index] !== 'doubtful') {
            questionStatus[index] = 'answered';
        }
        updateGridButtonStatus(index);
    }
    
    function updateNavButtons() {
        prevBtn.disabled = currentQuestionIndex === 0;
        nextBtn.disabled = currentQuestionIndex === questions.length - 1;
    }
    
    function updateGridButtonStatus(index) {
        const button = document.querySelectorAll('.question-grid-container button')[index];
        if (!button) return;
        
        button.classList.remove('answered', 'doubtful', 'unanswered');

        switch (questionStatus[index]) {
            case 'answered': button.classList.add('answered'); break;
            case 'doubtful': button.classList.add('doubtful'); break;
            default: button.classList.add('unanswered'); break;
        }
        document.querySelector('.grid-button.current')?.classList.remove('current');
        document.querySelectorAll('.question-grid-container button')[currentQuestionIndex].classList.add('current');
    }

    function jumpToQuestion(index) {
        displayQuestion(index);
    }

    function startTimer(duration) {
        let timer = duration;
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            let hours = parseInt(timer / 3600, 10);
            let minutes = parseInt((timer % 3600) / 60, 10);
            let seconds = parseInt(timer % 60, 10);

            hours = hours < 10 ? "0" + hours : hours;
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            timerEl.textContent = hours + ":" + minutes + ":" + seconds;
            
            if(timer < 300) timerEl.classList.add('low-time');

            if (--timer < 0) {
                clearInterval(timerInterval);
                finishQuiz();
            }
        }, 1000);
    }
    
    function showConfirmation() {
        confirmationModal.style.display = 'flex';
    }

    function finishQuiz() {
        clearInterval(timerInterval);
        confirmationModal.style.display = 'none';
        
        let score = 0;
        // Updated for CPNS Subtests
        const subtestScores = {
            'Tes Wawasan Kebangsaan (TWK)': { correct: 0, total: 0 },
            'Tes Intelegensia Umum (TIU)': { correct: 0, total: 0 },
            'Tes Karakteristik Pribadi (TKP)': { correct: 0, total: 0 },
        };
        const correctQuestionNumbers = [];
        const incorrectQuestionNumbers = [];

        questions.forEach((q, index) => {
            if (subtestScores[q.subtest]) {
                subtestScores[q.subtest].total++;
                if (userAnswers[index] === q.answer) {
                    score++;
                    subtestScores[q.subtest].correct++;
                    correctQuestionNumbers.push(index + 1);
                } else {
                    incorrectQuestionNumbers.push(index + 1);
                }
            }
        });
        
        quizContainer.style.display = 'none';
        resultPage.style.display = 'block';
        appHeader.style.display = 'flex';
        headerInfo.textContent = `Hasil Ujian: ${currentUsername}`;
        
        // Overall summary
        const overallPercentage = ((score / questions.length) * 100).toFixed(1);
        document.getElementById('final-score').textContent = `${overallPercentage}%`;
        document.getElementById('score-details').textContent = `${score} dari ${questions.length} soal benar`;

        // Subtest analysis
        const subtestAnalysisContainer = document.getElementById('subtest-analysis-container');
        subtestAnalysisContainer.innerHTML = '';
        for (const key in subtestScores) {
            const subtest = subtestScores[key];
            const percentage = subtest.total > 0 ? ((subtest.correct / subtest.total) * 100).toFixed(1) : 0;
            subtestAnalysisContainer.innerHTML += `
                <div class="subtest-card">
                    <h4>${key}</h4>
                    <div class="subtest-score" style="color: ${percentage >= 50 ? 'var(--correct-text)' : 'var(--incorrect-text)'}">${percentage}%</div>
                    <div>${subtest.correct}/${subtest.total} Benar</div>
                </div>`;
        }
        
        // Answer lists
        document.getElementById('correct-list').innerHTML = correctQuestionNumbers.map(n => `<li class="correct">${n}</li>`).join('');
        document.getElementById('incorrect-list').innerHTML = incorrectQuestionNumbers.map(n => `<li class="incorrect">${n}</li>`).join('');

        // Review section
        const reviewSection = document.getElementById('review-section');
        reviewSection.innerHTML = '';
        if (incorrectQuestionNumbers.length > 0) {
            document.getElementById('review-section-container').style.display = 'block';
            incorrectQuestionNumbers.forEach(num => {
                const index = num - 1;
                const q = questions[index];
                const userAnswerText = userAnswers[index] || 'Tidak Dijawab';
                reviewSection.innerHTML += `
                    <div class="review-item">
                        <p class="review-q-text"><strong>Soal ${num}:</strong> ${q.question}</p>
                        <div class="review-answer user-answer">Jawaban Anda: ${userAnswerText}</div>
                        <div class="review-answer correct-answer">Jawaban Benar: ${q.answer}</div>
                        <div class="explanation"><strong>Pembahasan:</strong> ${q.explanation}</div>
                    </div>
                `;
            });
        } else {
            reviewSection.innerHTML = '<p style="text-align:center; font-weight:500;">Luar biasa! Semua jawaban Anda benar.</p>';
        }
    }

    // Event Listeners
    loginBtn.addEventListener('click', handleLogin);
    passwordInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') handleLogin(); });
    logoutBtn.addEventListener('click', handleLogout);
    prevBtn.addEventListener('click', () => currentQuestionIndex > 0 && displayQuestion(currentQuestionIndex - 1));
    nextBtn.addEventListener('click', () => currentQuestionIndex < questions.length - 1 && displayQuestion(currentQuestionIndex + 1));
    doubtfulBtn.addEventListener('click', () => {
        questionStatus[currentQuestionIndex] = questionStatus[currentQuestionIndex] === 'doubtful' ? (userAnswers[currentQuestionIndex] ? 'answered' : 'unanswered') : 'doubtful';
        updateGridButtonStatus(currentQuestionIndex);
    });
    finishBtn.addEventListener('click', showConfirmation);
    confirmYesBtn.addEventListener('click', finishQuiz);
    confirmNoBtn.addEventListener('click', () => confirmationModal.style.display = 'none');
    restartBtn.addEventListener('click', startQuiz);

    // Initialize
    showLoginPage();
});
</script>
