    <style>

        :root {
            --primary-bg: #f0f2f5;
            --panel-bg: #ffffff;
            --header-bg: #0d47a1; /* Biru Tua */
            --header-text: #ffffff;
            --text-color: #333333;
            --border-color: #dee2e6;
            --primary-action-bg: #1976d2; /* Biru */
            --primary-action-hover: #1565c0;
            --answered-bg: #4caf50; /* Hijau */
            --correct-bg: #e8f5e9;
            --correct-text: #2e7d32;
            --incorrect-bg: #ffebee;
            --incorrect-text: #c62828;
            --doubtful-bg: #ffc107; /* Kuning */
            --current-bg: #ff9800; /* Oranye */
            --unanswered-bg: #ffffff;
            --timer-alert: #d32f2f; /* Merah */
        }

        
        /* --- Halaman Login --- */
        #login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-grow: 1;
            padding: 20px;
        }
        .login-box {
            background-color: var(--panel-bg);
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        .login-box h2 {
            margin-top: 0;
            margin-bottom: 25px;
            color: var(--header-bg);
        }
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box;
        }
        #login-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-action-bg);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #login-btn:hover {
            background-color: var(--primary-action-hover);
        }
        #login-error {
            color: var(--timer-alert);
            margin-top: 15px;
            font-weight: 500;
            display: none;
        }

        /* Header */
        .header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header h2 {
            font-size: 1.2em;
            margin: 0;
        }
        .user-info {
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        #logout-btn {
            background: none;
            border: 1px solid var(--header-text);
            color: var(--header-text);
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #logout-btn:hover {
            background-color: rgba(255,255,255,0.1);
        }


        /* Main Container */
        .quiz-container {
            display: flex;
            flex: 1;
            padding: 15px;
            gap: 15px;
            overflow: hidden;
            height: calc(100vh - 58px);
        }

        /* Question Panel (Left) */
        .question-panel {
            flex: 3;
            background-color: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .question-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            background-color: #f8f9fa;
        }
        .question-header #subtest-title {
            font-weight: 700;
            color: var(--header-bg);
        }
        .question-body {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
            line-height: 1.6;
        }
        .question-text {
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        .options-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .options-list li {
            margin-bottom: 10px;
        }
        .options-list label {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .options-list label:hover {
            background-color: #e3f2fd;
        }
        .options-list input[type="radio"] {
            margin-right: 15px;
            margin-top: 5px;
        }
        .options-list input[type="radio"]:checked + span {
            font-weight: 700;
        }
        .options-list label.selected {
            background-color: #bbdefb;
            border-color: var(--primary-action-bg);
        }

        /* Navigation Panel (Right) */
        .navigation-panel {
            flex: 1.2;
            background-color: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            min-width: 300px;
        }
        .timer-box {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }
        #timer {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--header-bg);
            letter-spacing: 2px;
        }
        #timer.low-time {
            color: var(--timer-alert);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .question-grid-container {
            padding: 15px;
            flex: 1;
            overflow-y: auto;
        }
        .subtest-group {
            margin-bottom: 15px;
        }
        .subtest-group h3 {
            font-size: 0.9em;
            margin: 0 0 10px 0;
            color: var(--text-color);
            border-bottom: 2px solid var(--primary-action-bg);
            padding-bottom: 5px;
        }
        .question-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 8px;
        }
        .grid-button {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border-color);
            background-color: var(--unanswered-bg);
            cursor: pointer;
            border-radius: 5px;
            font-weight: 500;
            transition: all 0.2s;
        }
        .grid-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .grid-button.answered { background-color: var(--answered-bg); color: white; border-color: var(--answered-bg); }
        .grid-button.doubtful { background-color: var(--doubtful-bg); border-color: var(--doubtful-bg); }
        .grid-button.current { border: 2px solid var(--current-bg); }

        /* Footer / Actions */
        .quiz-actions {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8f9fa;
        }
        .action-button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 700;
            transition: background-color 0.2s;
        }
        #prev-btn, #next-btn {
            background-color: var(--primary-action-bg);
            color: white;
        }
        #prev-btn:disabled, #next-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #doubtful-btn {
            background-color: var(--doubtful-bg);
            color: #333;
        }
        #finish-btn {
            background-color: var(--timer-alert);
            color: white;
        }

        /* Confirmation Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            animation: slide-down 0.3s ease-out;
        }
        @keyframes slide-down {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-content h2 {
            margin-top: 0;
            color: var(--header-bg);
        }
        .modal-actions {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        #confirm-yes {
            background-color: var(--primary-action-bg);
            color: white;
        }
        #confirm-no {
            background-color: #6c757d;
            color: white;
        }
        
        /* --- Result Page Styles --- */
        .result-container {
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        .result-container h2, .result-container h3 {
            color: var(--header-bg);
        }
        .result-card {
            background-color: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .overall-summary {
            text-align: center;
        }
        .overall-summary .score {
            font-size: 3em;
            font-weight: 700;
            color: var(--answered-bg);
        }
        .overall-summary .score-details {
            font-size: 1.1em;
            color: var(--text-color);
        }
        .subtest-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .subtest-card {
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            text-align: center;
        }
        .subtest-card h4 {
            margin: 0 0 10px 0;
        }
        .subtest-card .subtest-score {
            font-size: 1.5em;
            font-weight: 500;
        }

        .answer-list {
            padding: 0;
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .answer-list li {
            width: 35px;
            height: 35px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            font-weight: 500;
        }
        .answer-list li.correct {
            background-color: var(--correct-text);
            color: white;
        }
        .answer-list li.incorrect {
            background-color: var(--incorrect-text);
            color: white;
        }
        
        .review-item {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        .review-item .review-q-text {
            font-weight: 500;
        }
        .review-item .review-answer {
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
        }
        .review-item .user-answer {
            background-color: var(--incorrect-bg);
            border-left: 4px solid var(--incorrect-text);
            color: var(--incorrect-text);
        }
        .review-item .correct-answer {
            background-color: var(--correct-bg);
            border-left: 4px solid var(--correct-text);
            color: var(--correct-text);
        }
        .review-item .explanation {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-style: italic;
        }
        #restart-btn {
            margin-top: 20px;
            padding: 12px 25px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: var(--primary-action-bg);
            color: white;
        }
        
        /* Hidden by default */
        .header, .quiz-container, #result-page {
            display: none;
        }
        
        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            .quiz-container {
                flex-direction: column;
                height: auto;
                overflow: visible;
            }
            .navigation-panel {
                min-width: unset;
                flex: unset; /* Unset flex grow/shrink */
                height: auto;
            }
            .question-panel {
                min-height: 40vh;
            }
            .header h2 {
                font-size: 1em;
            }
        }
        
        @media (max-width: 480px) {
            .login-box {
                padding: 20px;
            }
            .question-body, .quiz-actions {
                padding: 15px;
            }
            .action-button {
                padding: 8px 12px;
                font-size: 0.9em;
            }
        }

    </style>

    
    <div id="login-container">
        <div class="login-box">
            <h2>Login Peserta Ujian</h2>
            <div class="input-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Masukkan username Anda">
            </div>
            <div class="input-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Masukkan password">
            </div>
            <button id="login-btn">Masuk</button>
            <p id="login-error">Password salah. Coba lagi.</p>
        </div>
    </div>

    <header class="header">
        <h2>Simulasi Tes Bakat Skolastik (TBS) LPDP 2025</h2>
        <div class="user-info">
            <span id="header-info"></span>
            <button id="logout-btn">Logout</button>
        </div>
    </header>

    <div class="quiz-container">
        <!-- Panel Soal -->
        <main class="question-panel">
            <div class="question-header">
                <span id="subtest-title">Subtes</span> | Soal No. <span id="question-number">1</span>
            </div>
            <div class="question-body">
                <p id="question-text">Memuat soal...</p>
                <ul id="options" class="options-list"></ul>
            </div>
            <div class="quiz-actions">
                <button id="prev-btn" class="action-button">Sebelumnya</button>
                <button id="doubtful-btn" class="action-button">Ragu-ragu</button>
                <button id="next-btn" class="action-button">Selanjutnya</button>
            </div>
        </main>

        <!-- Panel Navigasi -->
        <aside class="navigation-panel">
            <div class="timer-box">
                Sisa Waktu
                <div id="timer">90:00</div>
            </div>
            <div class="question-grid-container">
                <div class="subtest-group">
                    <h3>Penalaran Verbal (1-23)</h3>
                    <div id="grid-verbal" class="question-grid"></div>
                </div>
                <div class="subtest-group">
                    <h3>Penalaran Kuantitatif (24-48)</h3>
                    <div id="grid-kuantitatif" class="question-grid"></div>
                </div>
                <div class="subtest-group">
                    <h3>Pemecahan Masalah (49-60)</h3>
                    <div id="grid-masalah" class="question-grid"></div>
                </div>
            </div>
            <div class="quiz-actions" style="justify-content: center;">
                <button id="finish-btn" class="action-button">Selesaikan Ujian</button>
            </div>
        </aside>
    </div>

    <!-- Halaman Hasil Ujian -->
    <div id="result-page" class="result-container">
        <div class="result-card overall-summary">
            <h2>Hasil Akhir Ujian</h2>
            <div id="final-score" class="score">0%</div>
            <div id="score-details" class="score-details"></div>
            <div id="subtest-analysis-container" class="subtest-analysis"></div>
        </div>
        
        <div class="result-card">
            <h3>Rekap Jawaban</h3>
            <h4>Jawaban Benar</h4>
            <ul id="correct-list" class="answer-list"></ul>
            <h4 style="margin-top: 20px;">Jawaban Salah / Kosong</h4>
            <ul id="incorrect-list" class="answer-list"></ul>
        </div>
        
        <div id="review-section-container" class="result-card">
            <h3>Pembahasan Jawaban Salah</h3>
            <div id="review-section"></div>
        </div>
        
        <div style="text-align: center;">
           <button id="restart-btn" class="action-button">Ulangi Ujian</button>
        </div>
    </div>
    
    <!-- Modal Konfirmasi Selesai -->
    <div id="confirmation-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Selesaikan Ujian?</h2>
            <p>Apakah Anda yakin ingin menyelesaikan dan mengakhiri sesi ujian ini?</p>
            <div class="modal-actions">
                <button id="confirm-no" class="action-button">Batal</button>
                <button id="confirm-yes" class="action-button">Ya, Selesaikan</button>
            </div>
        </div>
    </div>


<script>
// --- DATABASE SOAL DENGAN PEMBAHASAN ---
const questions = [
    // --- PENALARAN VERBAL (23 Soal) ---
    { subtest: 'Penalaran Verbal', question: 'GELAP : TERANG = ... : ...', options: ['Basah : Kering', 'Lapar : Kenyang', 'Siang : Pagi', 'Hitam : Abu-abu'], answer: 'Basah : Kering', explanation: 'Hubungan kata adalah antonim (lawan kata). GELAP adalah lawan kata dari TERANG, sama seperti BASAH adalah lawan kata dari KERING.' },
    { subtest: 'Penalaran Verbal', question: 'Semua mahasiswa memakai sepatu. Sebagian mahasiswa memakai topi. Kesimpulan yang paling tepat adalah...', options: ['Sebagian mahasiswa memakai sepatu dan topi.', 'Semua mahasiswa yang memakai topi pasti memakai sepatu.', 'Sebagian mahasiswa tidak memakai topi tapi memakai sepatu.', 'Semua jawaban benar.'], answer: 'Semua jawaban benar.', explanation: 'Dari premis "Semua mahasiswa memakai sepatu", dapat disimpulkan bahwa mahasiswa yang memakai topi (yang merupakan bagian dari mahasiswa) juga pasti memakai sepatu. Pilihan A, B, dan C adalah turunan logis dari kedua premis.' },
    { subtest: 'Penalaran Verbal', question: 'Pilih kata yang tidak termasuk dalam kelompoknya.', options: ['Singa', 'Harimau', 'Elang', 'Macan'], answer: 'Elang', explanation: 'Singa, Harimau, dan Macan adalah kelompok mamalia karnivora darat. Elang adalah seekor burung (aves).' },
    ...Array(20).fill({ subtest: 'Penalaran Verbal', question: 'Contoh soal Penalaran Verbal tambahan. Manakah sinonim dari kata "Kredibel"?', options: ['Dapat dipercaya', 'Meragukan', 'Mustahil', 'Biasa saja'], answer: 'Dapat dipercaya', explanation: '"Kredibel" berarti dapat dipercaya atau diandalkan.' }),

    // --- PENALARAN KUANTITATIF (25 Soal) ---
    { subtest: 'Penalaran Kuantitatif', question: 'Seri Angka: 3, 5, 8, 12, 17, ...', options: ['23', '24', '25', '26'], answer: '23', explanation: 'Pola deret adalah penjumlahan bertingkat: +2, +3, +4, +5. Maka angka selanjutnya adalah 17 + 6 = 23.' },
    { subtest: 'Penalaran Kuantitatif', question: 'Jika x = 25% dari 80 dan y = 40% dari 60, maka...', options: ['x > y', 'x < y', 'x = y', 'Hubungan tidak dapat ditentukan'], answer: 'x < y', explanation: 'x = 0.25 * 80 = 20. y = 0.40 * 60 = 24. Jadi, x < y.' },
    { subtest: 'Penalaran Kuantitatif', question: 'Sebuah proyek dijadwalkan selesai dalam 40 hari oleh 20 pekerja. Setelah 10 hari, proyek dihentikan selama 5 hari. Berapa tambahan pekerja yang dibutuhkan agar proyek selesai tepat waktu?', options: ['4 pekerja', '6 pekerja', '8 pekerja', '10 pekerja'], answer: '4 pekerja', explanation: 'Sisa pekerjaan normal: 40 hari * 20 pekerja = 800. Pekerjaan selesai: 10 hari * 20 pekerja = 200. Sisa pekerjaan: 800 - 200 = 600. Sisa waktu: 40 - 10 - 5 = 25 hari. Pekerja dibutuhkan (N): N * 25 = 600 -> N = 24. Tambahan pekerja: 24 - 20 = 4 pekerja.'},
    ...Array(22).fill({ subtest: 'Penalaran Kuantitatif', question: 'Contoh soal Kuantitatif tambahan. Berapakah 15% dari 300?', options: ['30', '45', '50', '60'], answer: '45', explanation: '15% dari 300 adalah (15/100) * 300 = 45.' }),

    // --- PEMECAHAN MASALAH (12 Soal) ---
    { subtest: 'Pemecahan Masalah', question: 'Dalam sebuah rapat, A, B, C, D, dan E duduk mengelilingi meja bundar. A tidak bersebelahan dengan B. C duduk di antara D dan E. Siapa yang duduk di seberang C jika D duduk di sebelah kiri A?', options: ['A', 'B', 'D', 'E'], answer: 'A', explanation: 'Urutan yang mungkin adalah A-E-C-D-B (searah jarum jam). Dalam formasi ini, A duduk di seberang C.' },
    { subtest: 'Pemecahan Masalah', question: 'Semua burung bisa terbang. Penguin adalah burung. Maka...', options: ['Penguin bisa terbang', 'Beberapa penguin bisa terbang', 'Kesimpulan tidak dapat ditarik', 'Premis kedua salah'], answer: 'Kesimpulan tidak dapat ditarik', explanation: 'Kesimpulan ini adalah contoh silogisme yang salah karena premis pertamanya ("Semua burung bisa terbang") secara faktual salah. Dalam logika formal, jika premis salah, kesimpulan yang valid tidak bisa ditarik, meskipun secara struktur tampak logis.' },
    ...Array(10).fill({ subtest: 'Pemecahan Masalah', question: 'Contoh soal Pemecahan Masalah tambahan. Jika kemarin adalah hari Selasa, hari apakah lusa?', options: ['Rabu', 'Kamis', 'Jumat', 'Sabtu'], answer: 'Jumat', explanation: 'Jika kemarin Selasa, maka hari ini adalah Rabu. Lusa adalah dua hari setelah hari ini, yaitu Jumat.' }),
];

// --- LOGIKA KUIS ---
document.addEventListener('DOMContentLoaded', () => {
    let currentQuestionIndex = 0;
    let userAnswers = new Array(questions.length).fill(null);
    let questionStatus = new Array(questions.length).fill('unanswered'); // unanswered, answered, doubtful
    let timerInterval;
    let currentUsername = '';

    // Element Cache
    const loginContainer = document.getElementById('login-container');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const loginBtn = document.getElementById('login-btn');
    const loginError = document.getElementById('login-error');

    const appHeader = document.querySelector('.header');
    const quizContainer = document.querySelector('.quiz-container');
    const resultPage = document.getElementById('result-page');
    
    const subtestTitleEl = document.getElementById('subtest-title');
    const questionNumberEl = document.getElementById('question-number');
    const questionTextEl = document.getElementById('question-text');
    const optionsEl = document.getElementById('options');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const doubtfulBtn = document.getElementById('doubtful-btn');
    const finishBtn = document.getElementById('finish-btn');
    const timerEl = document.getElementById('timer');
    const restartBtn = document.getElementById('restart-btn');
    const logoutBtn = document.getElementById('logout-btn');
    
    const confirmationModal = document.getElementById('confirmation-modal');
    const confirmYesBtn = document.getElementById('confirm-yes');
    const confirmNoBtn = document.getElementById('confirm-no');
    const headerInfo = document.getElementById('header-info');

    function showLoginPage() {
        loginContainer.style.display = 'flex';
        appHeader.style.display = 'none';
        quizContainer.style.display = 'none';
        resultPage.style.display = 'none';
        passwordInput.value = '';
        loginError.style.display = 'none';
    }

    function handleLogin() {
        const password = passwordInput.value;
        const username = usernameInput.value.trim();
        
        if (username === "") {
            loginError.textContent = "Username tidak boleh kosong.";
            loginError.style.display = 'block';
            return;
        }

        if (password === "ujiandiakazed.com") {
            currentUsername = username;
            loginContainer.style.display = 'none';
            appHeader.style.display = 'flex';
            quizContainer.style.display = 'flex';
            headerInfo.textContent = `Peserta: ${currentUsername}`;
            startQuiz();
        } else {
            loginError.textContent = "Password salah. Coba lagi.";
            loginError.style.display = 'block';
        }
    }
    
    function handleLogout() {
        clearInterval(timerInterval);
        showLoginPage();
    }

    function startQuiz() {
        currentQuestionIndex = 0;
        userAnswers.fill(null);
        questionStatus.fill('unanswered');
        
        quizContainer.style.display = 'flex';
        resultPage.style.display = 'none';
        
        setupQuestionGrids();
        displayQuestion(currentQuestionIndex);
        startTimer(90 * 60);
    }

    function setupQuestionGrids() {
        const grids = {
            'Penalaran Verbal': document.getElementById('grid-verbal'),
            'Penalaran Kuantitatif': document.getElementById('grid-kuantitatif'),
            'Pemecahan Masalah': document.getElementById('grid-masalah')
        };
        Object.values(grids).forEach(grid => grid.innerHTML = '');

        questions.forEach((q, index) => {
            const button = document.createElement('button');
            button.className = 'grid-button';
            button.textContent = index + 1;
            button.onclick = () => jumpToQuestion(index);
            grids[q.subtest].appendChild(button);
        });
    }

    function displayQuestion(index) {
        document.querySelector('.grid-button.current')?.classList.remove('current');
        currentQuestionIndex = index;
        const question = questions[index];

        subtestTitleEl.textContent = question.subtest;
        questionNumberEl.textContent = index + 1;
        questionTextEl.innerHTML = question.question;
        optionsEl.innerHTML = '';

        question.options.forEach(option => {
            const li = document.createElement('li');
            const label = document.createElement('label');
            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = 'option';
            radio.value = option;
            if (userAnswers[index] === option) {
                radio.checked = true;
                label.classList.add('selected');
            }
            radio.onchange = () => selectAnswer(index, option);
            
            const span = document.createElement('span');
            span.textContent = option;
            
            label.appendChild(radio);
            label.appendChild(span);
            li.appendChild(label);
            optionsEl.appendChild(li);
        });
        
        updateNavButtons();
        updateGridButtonStatus(index);
        document.querySelectorAll('.question-grid-container button')[index].classList.add('current');
    }

    function selectAnswer(index, answer) {
        userAnswers[index] = answer;
        document.querySelectorAll('#options label').forEach(l => l.classList.remove('selected'));
        document.querySelector(`input[value="${CSS.escape(answer)}"]`).parentElement.classList.add('selected');

        if (questionStatus[index] !== 'doubtful') {
            questionStatus[index] = 'answered';
        }
        updateGridButtonStatus(index);
    }
    
    function updateNavButtons() {
        prevBtn.disabled = currentQuestionIndex === 0;
        nextBtn.disabled = currentQuestionIndex === questions.length - 1;
    }
    
    function updateGridButtonStatus(index) {
        const button = document.querySelectorAll('.question-grid-container button')[index];
        if (!button) return;
        
        button.classList.remove('answered', 'doubtful', 'unanswered');

        switch (questionStatus[index]) {
            case 'answered': button.classList.add('answered'); break;
            case 'doubtful': button.classList.add('doubtful'); break;
            default: button.classList.add('unanswered'); break;
        }
        // Ensure current is always set on the right button
        document.querySelector('.grid-button.current')?.classList.remove('current');
        document.querySelectorAll('.question-grid-container button')[currentQuestionIndex].classList.add('current');
    }

    function jumpToQuestion(index) {
        displayQuestion(index);
    }

    function startTimer(duration) {
        let timer = duration;
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            let minutes = parseInt(timer / 60, 10);
            let seconds = parseInt(timer % 60, 10);

            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            timerEl.textContent = minutes + ":" + seconds;
            
            if (timer < 300) timerEl.classList.add('low-time');

            if (--timer < 0) {
                clearInterval(timerInterval);
                finishQuiz();
            }
        }, 1000);
    }
    
    function showConfirmation() {
        confirmationModal.style.display = 'flex';
    }

    function finishQuiz() {
        clearInterval(timerInterval);
        confirmationModal.style.display = 'none';

        // Calculate scores
        let score = 0;
        const subtestScores = {
            'Penalaran Verbal': { correct: 0, total: 0 },
            'Penalaran Kuantitatif': { correct: 0, total: 0 },
            'Pemecahan Masalah': { correct: 0, total: 0 },
        };
        const correctQuestionNumbers = [];
        const incorrectQuestionNumbers = [];

        questions.forEach((q, index) => {
            subtestScores[q.subtest].total++;
            if (userAnswers[index] === q.answer) {
                score++;
                subtestScores[q.subtest].correct++;
                correctQuestionNumbers.push(index + 1);
            } else {
                incorrectQuestionNumbers.push(index + 1);
            }
        });

        // Display results
        quizContainer.style.display = 'none';
        resultPage.style.display = 'block';
        headerInfo.textContent = `Hasil Ujian: ${currentUsername}`;
        
        // Overall summary
        const overallPercentage = ((score / questions.length) * 100).toFixed(1);
        document.getElementById('final-score').textContent = `${overallPercentage}%`;
        document.getElementById('score-details').textContent = `${score} dari ${questions.length} soal benar`;
        
        // Subtest analysis
        const subtestAnalysisContainer = document.getElementById('subtest-analysis-container');
        subtestAnalysisContainer.innerHTML = '';
        for (const key in subtestScores) {
            const subtest = subtestScores[key];
            const percentage = subtest.total > 0 ? ((subtest.correct / subtest.total) * 100).toFixed(1) : 0;
            subtestAnalysisContainer.innerHTML += `
                <div class="subtest-card">
                    <h4>${key}</h4>
                    <div class="subtest-score" style="color: ${percentage >= 50 ? 'var(--correct-text)' : 'var(--incorrect-text)'}">${percentage}%</div>
                    <div>${subtest.correct}/${subtest.total} Benar</div>
                </div>`;
        }
        
        // Answer lists
        document.getElementById('correct-list').innerHTML = correctQuestionNumbers.map(n => `<li class="correct">${n}</li>`).join('');
        document.getElementById('incorrect-list').innerHTML = incorrectQuestionNumbers.map(n => `<li class="incorrect">${n}</li>`).join('');

        // Review section for incorrect answers
        const reviewSection = document.getElementById('review-section');
        reviewSection.innerHTML = '';
        if (incorrectQuestionNumbers.length > 0) {
            incorrectQuestionNumbers.forEach(num => {
                const index = num - 1;
                const q = questions[index];
                const userAnswerText = userAnswers[index] || 'Tidak Dijawab';
                reviewSection.innerHTML += `
                    <div class="review-item">
                        <p class="review-q-text"><strong>Soal ${num}:</strong> ${q.question}</p>
                        <div class="review-answer user-answer">Jawaban Anda: ${userAnswerText}</div>
                        <div class="review-answer correct-answer">Jawaban Benar: ${q.answer}</div>
                        <div class="explanation"><strong>Pembahasan:</strong> ${q.explanation}</div>
                    </div>
                `;
            });
        } else {
            reviewSection.innerHTML = '<p style="text-align:center; font-weight:500;">Luar biasa! Semua jawaban Anda benar.</p>';
        }
    }

    // Event Listeners
    loginBtn.addEventListener('click', handleLogin);
    passwordInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') handleLogin(); });
    logoutBtn.addEventListener('click', handleLogout);
    
    prevBtn.addEventListener('click', () => currentQuestionIndex > 0 && displayQuestion(currentQuestionIndex - 1));
    nextBtn.addEventListener('click', () => currentQuestionIndex < questions.length - 1 && displayQuestion(currentQuestionIndex + 1));
    doubtfulBtn.addEventListener('click', () => {
        questionStatus[currentQuestionIndex] = questionStatus[currentQuestionIndex] === 'doubtful' ? (userAnswers[currentQuestionIndex] ? 'answered' : 'unanswered') : 'doubtful';
        updateGridButtonStatus(currentQuestionIndex);
    });
    finishBtn.addEventListener('click', showConfirmation);
    confirmYesBtn.addEventListener('click', finishQuiz);
    confirmNoBtn.addEventListener('click', () => confirmationModal.style.display = 'none');
    restartBtn.addEventListener('click', startQuiz);

    // Initialize
    showLoginPage();
});
</script>
